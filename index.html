<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ëŠë¦°ì•„ì´ ìˆ«ì</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        warm: {
                            50: '#FDFCFA', 100: '#FAF7F2', 200: '#F3EDE4',
                            300: '#E8DFD2', 400: '#B8AD9E', 500: '#8C8070',
                            600: '#6B5F50', 700: '#4A4035', 800: '#2E261D',
                        },
                        app: {
                            blue: '#6BADE8', green: '#5BC886', orange: '#F0A050', red: '#F07070',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;900&display=swap');

        *, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0; padding: 0;
            background: #F5F1EB;
            min-height: 100dvh;
            display: flex; justify-content: center; align-items: flex-start;
        }

        .app {
            width: 100%; max-width: 600px;
            min-height: 100dvh;
            background: white;
            padding: 24px 16px;
            padding-top: max(24px, env(safe-area-inset-top));
            padding-bottom: max(24px, env(safe-area-inset-bottom));
            display: flex; flex-direction: column;
        }

        /* íƒœë¸”ë¦¿ ë¯¸ë””ì–´ì¿¼ë¦¬: í•˜ë‹¨ í†µí•© */

        /* ê²Œì„ ì„¹ì…˜ ì»¨í…Œì´ë„ˆ */
        .game-section {
            background: #FDFCFA;
            border: 1.5px solid #F0ECE6;
            border-radius: 18px;
            padding: 14px;
        }
        .game-section-header {
            display: flex; align-items: center; gap: 8px;
            margin-bottom: 10px; padding: 0 2px;
        }
        .game-section-title {
            font-size: 1rem; font-weight: 800; color: #4A4035;
        }
        .game-section-desc {
            font-size: 0.7rem; color: #B8AD9E;
        }

        /* ì„¤ì • ì»¨íŠ¸ë¡¤ ê·¸ë£¹ */
        .settings-group {
            background: white;
            border: 1.5px solid #F0ECE6;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .settings-row {
            display: flex; align-items: center;
            padding: 0;
        }
        .settings-row + .settings-row {
            border-top: 1px solid #F0ECE6;
        }
        .settings-label {
            width: 36px; flex-shrink: 0;
            font-size: 0.68rem; font-weight: 700;
            color: #B8AD9E;
            text-align: center;
            padding: 8px 0;
        }
        .settings-options {
            display: flex; flex: 1;
        }
        .settings-options .counting-mode-btn {
            flex: 1;
            padding: 8px 0;
            text-align: center;
            font-size: 0.72rem; font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
            border: none; border-radius: 0;
        }
        .settings-options .counting-mode-btn + .counting-mode-btn {
            border-left: 1px solid #F0ECE6;
        }

        /* ëª¨ë“œ ì¹´ë“œ */
        .mode-card {
            transition: transform 0.12s, box-shadow 0.12s;
            cursor: pointer; user-select: none;
            border-left: 3.5px solid transparent !important;
        }
        .mode-card:active { transform: scale(0.97); }
        .mode-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.06); }

        /* ë‚œì´ë„ë³„ ì¹´ë“œ ì•¡ì„¼íŠ¸ ìƒ‰ìƒ */
        .mode-card[data-range="5"]   { border-left-color: #5BC886 !important; }
        .mode-card[data-range="10"]  { border-left-color: #6BADE8 !important; }
        .mode-card[data-range="20"]  { border-left-color: #9B8FE8 !important; }
        .mode-card[data-range="30"]  { border-left-color: #F0A050 !important; }
        .mode-card[data-range="50"]  { border-left-color: #E87B7B !important; }
        .mode-card[data-range="100"] { border-left-color: #C46BE8 !important; }

        /* í™ˆ ë²„íŠ¼ */
        .btn-home {
            width: 36px; height: 36px; border-radius: 10px;
            border: 2px solid #E8E2DA; background: white;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: background 0.15s;
            font-size: 1rem; color: #8C8070;
        }
        .btn-home:active { background: #F5F1EB; }

        /* í”„ë¡œê·¸ë ˆìŠ¤ */
        .progress-track { height: 8px; border-radius: 99px; background: #F0ECE6; overflow: hidden; }
        .progress-bar {
            height: 100%; border-radius: 99px;
            background: linear-gradient(90deg, #6BADE8, #5BC886);
            transition: width 0.5s ease;
        }

        /* ìŠ¬ë¡¯ ê·¸ë¦¬ë“œ */
        .slots-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
            width: 100%;
        }

        /* ë¹ˆì¹¸ ìŠ¬ë¡¯ */
        .slot {
            aspect-ratio: 1;
            width: 100%;
            border: 2.5px dashed #D0C8BC;
            border-radius: 12px;
            background: #FDFCFA;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; font-weight: 800;
            color: #D0C8BC;
            transition: all 0.2s;
            position: relative;
        }
        .slot .ghost-num {
            color: #E0D8CC;
            font-weight: 800;
            font-size: inherit;
            user-select: none;
            pointer-events: none;
        }
        .slot.drag-over {
            border-color: #6BADE8; border-style: solid;
            background: #EEF6FD;
            transform: scale(1.08);
        }
        .slot.filled {
            border: 2.5px solid #5BC886;
            background: #D4F5E0;
            color: #1A7A3A;
            cursor: default;
        }
        .slot.wrong {
            border-color: #F07070;
            background: #FDE8E8;
            animation: shake 0.4s ease;
        }

        /* í©ë¿Œë¦¬ê¸° ì˜ì—­ */
        .scatter-area {
            position: relative;
            width: 100%;
            min-height: 220px;
        }

        /* ë“œë˜ê·¸ ìˆ«ì */
        .num-chip {
            width: 34px; height: 34px;
            border-radius: 50%;
            border: 2px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.78rem; font-weight: 800;
            color: #4A4035;
            cursor: grab;
            touch-action: none;
            user-select: none;
            position: absolute;
            transition: transform 0.1s, box-shadow 0.1s, opacity 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .num-chip:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
        .num-chip:active { cursor: grabbing; }
        .num-chip.dragging {
            opacity: 0.3;
        }
        .num-chip.placed {
            opacity: 0; pointer-events: none;
            transform: scale(0.5);
        }

        /* í”Œë¡œíŒ… */
        .floating-num {
            position: fixed; z-index: 9999; pointer-events: none;
            width: 42px; height: 42px;
            border-radius: 12px;
            background: #4A4035;
            color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.98rem; font-weight: 900;
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.3s ease-out; }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.15); }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in { animation: pop 0.35s ease-out; }

        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ë¹ˆì¹¸ ë§ì¶”ê¸° ì¹´ë“œ */
        .quiz-card {
            width: 72px; height: 72px;
            border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: 900;
            user-select: none;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .quiz-cards-8 .quiz-card {
            width: 58px; height: 58px;
            font-size: 1.25rem;
            border-radius: 14px;
        }
        .quiz-card.open {
            border: 2.5px solid #6BADE8;
            background: #EEF6FD;
            color: #2E7FD9;
        }
        .quiz-card.hidden-card {
            border: 2.5px dashed #D0C8BC;
            background: #FDFCFA;
            color: #D0C8BC;
            font-size: 1.2rem;
        }
        .quiz-card.hidden-card.drag-over {
            border-color: #6BADE8; border-style: solid;
            background: #D9EDFC;
            transform: scale(1.08);
        }
        .quiz-card.hidden-card.filled {
            border: 2.5px solid #5BC886;
            background: #D4F5E0;
            color: #1A7A3A;
        }
        .quiz-card.hidden-card.wrong {
            border-color: #F07070;
            background: #FDE8E8;
            animation: shake 0.4s ease;
        }
        /* quiz-card íƒœë¸”ë¦¿: í•˜ë‹¨ í†µí•© */

        /* ë¹ˆì¹¸ ë§ì¶”ê¸° ì¹© */
        .quiz-chip {
            width: 56px; height: 56px;
            border-radius: 50%;
            border: 2.5px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; font-weight: 800;
            color: #4A4035;
            cursor: grab;
            touch-action: none;
            user-select: none;
            transition: transform 0.1s, box-shadow 0.1s, opacity 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .quiz-chip:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
        .quiz-chip:active { cursor: grabbing; }
        .quiz-chip.dragging { opacity: 0.3; }
        .quiz-chip.placed { opacity: 0; pointer-events: none; transform: scale(0.5); }

        /* ì„¤ì • í† ê¸€ */
        .impulse-toggle {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 14px;
            border-radius: 14px;
            border: 1.5px solid #F0ECE6;
            background: #FDFCFA;
            transition: border-color 0.2s, background 0.2s;
        }
        .impulse-toggle.active { border-color: #6BADE8; background: #F5FAFF; }
        .toggle-switch {
            width: 40px; height: 22px;
            border-radius: 11px;
            background: #D0C8BC;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
            flex-shrink: 0;
        }
        .toggle-switch.on { background: #6BADE8; }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 18px; height: 18px;
            border-radius: 50%;
            background: white;
            top: 2px; left: 2px;
            transition: transform 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
        }
        .toggle-switch.on::after { transform: translateX(18px); }
        .impulse-details {
            overflow: hidden;
            max-height: 0; opacity: 0;
            transition: max-height 0.3s, opacity 0.3s, margin 0.3s;
            margin-top: 0;
        }
        .impulse-details.show { max-height: 200px; opacity: 1; margin-top: 9px; }
        .impulse-mode-options {
            display: grid; grid-template-columns: 1fr 1fr; gap: 7px;
            margin-bottom: 9px;
        }
        .impulse-mode-btn {
            display: flex; flex-direction: column; align-items: center;
            padding: 9px 7px;
            border-radius: 13px;
            border: 2px solid #E8E2DA;
            background: white;
            cursor: pointer;
            transition: all 0.15s;
        }
        .impulse-mode-btn.selected { border-color: #6BADE8; background: #EEF6FD; }
        .impulse-mode-icon { font-size: 1.08rem; margin-bottom: 2px; }
        .impulse-mode-label { font-size: 0.72rem; font-weight: 700; color: #4A4035; }
        .impulse-mode-desc { font-size: 0.59rem; color: #B8AD9E; margin-top: 1px; }
        .delay-options {
            display: flex; gap: 4px;
            flex-wrap: wrap; justify-content: center;
        }
        .delay-btn {
            min-width: 34px; height: 27px; padding: 0 5px;
            border-radius: 14px;
            border: 2px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.68rem; font-weight: 700;
            color: #6B5F50;
            cursor: pointer;
            transition: all 0.15s;
        }
        .delay-btn.selected { border-color: #6BADE8; background: #6BADE8; color: white; }
        /* ì¶©ë™ë°©ì§€: ë³´ê¸° ìˆ¨ê¹€ / ì„ íƒ ì ê¸ˆ */
        /* ì½ê¸° ëª¨ë“œ ì„ íƒ */
        .counting-mode-btn {
            background: white; color: #8C8070; border: none;
        }
        .counting-mode-btn.selected {
            background: #EEF6FD; color: #2E7FD9;
        }

        /* ëª¨ë“œ ì•„ì´ì½˜ ì• ë‹ˆë©”ì´ì…˜ */
        /* ìˆ«ì ìˆœì„œ: 3ì¹¸ ìŠ¬ë¡¯ì— 1,2,3ì´ ì°¨ë¡€ë¡œ ì±„ì›Œì§ */
        .icon-order {
            width: 72px; height: 36px;
            display: flex; align-items: center; gap: 4px;
            flex-shrink: 0;
        }
        .icon-order .slot-box {
            width: 20px; height: 28px; border-radius: 5px;
            border: 2px dashed #D0C8BC;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 900; color: white;
            position: relative; overflow: hidden;
        }
        .icon-order .slot-box .num-fill {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            border-radius: 4px;
        }
        .icon-order .slot-box:nth-child(1) .num-fill {
            background: #5BC886; animation: orderFill1 3.5s ease infinite;
        }
        .icon-order .slot-box:nth-child(2) .num-fill {
            background: #5BC886; animation: orderFill2 3.5s ease infinite;
        }
        .icon-order .slot-box:nth-child(3) .num-fill {
            background: #5BC886; animation: orderFill3 3.5s ease infinite;
        }
        @keyframes orderFill1 {
            0%, 10% { opacity: 0; transform: translateY(12px); }
            20%, 65% { opacity: 1; transform: translateY(0); }
            78%, 100% { opacity: 0; transform: translateY(0); }
        }
        @keyframes orderFill2 {
            0%, 25% { opacity: 0; transform: translateY(12px); }
            35%, 65% { opacity: 1; transform: translateY(0); }
            78%, 100% { opacity: 0; transform: translateY(0); }
        }
        @keyframes orderFill3 {
            0%, 40% { opacity: 0; transform: translateY(12px); }
            50%, 65% { opacity: 1; transform: translateY(0); }
            78%, 100% { opacity: 0; transform: translateY(0); }
        }
        /* ë¹ˆì¹¸ ë§ì¶”ê¸°: 1 [?â†’2] 3 */
        .icon-blank {
            width: 72px; height: 36px;
            display: inline-flex; align-items: center; gap: 4px;
            flex-shrink: 0; overflow: visible;
        }
        .icon-blank .ib-card {
            width: 20px; height: 28px; border-radius: 5px;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 900;
            flex-shrink: 0;
        }
        .icon-blank .ib-card.ib-fixed {
            background: #EEF6FD; border: 2px solid #6BADE8; color: #2E7FD9;
        }
        .icon-blank .ib-card.ib-empty {
            border: 2px dashed #D0C8BC; color: #D0C8BC;
            position: relative; overflow: hidden;
        }
        .icon-blank .ib-card.ib-empty .ib-q {
            position: absolute;
            animation: ibReveal 2.5s ease infinite;
        }
        .icon-blank .ib-card.ib-empty .ib-ans {
            position: absolute; inset: 0;
            background: #D4F5E0; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 900; color: #1A7A3A;
            animation: ibFill 2.5s ease infinite;
        }
        @keyframes ibReveal {
            0%, 40% { opacity: 1; }
            50%, 90% { opacity: 0; }
            100% { opacity: 1; }
        }
        @keyframes ibFill {
            0%, 40% { opacity: 0; }
            50%, 85% { opacity: 1; }
            90%, 100% { opacity: 0; }
        }

        .chips-hidden { visibility: hidden; }
        .chips-locked { pointer-events: none; opacity: 0.45; }

        .reveal-btn {
            display: block;
            width: 100%;
            max-width: 320px;
            margin: 0 auto 12px;
            padding: 14px 0;
            border-radius: 14px;
            border: 2px solid #6BADE8;
            background: #EEF6FD;
            color: #2E7FD9;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }
        .reveal-btn:active {
            background: #D9EDFC;
            transform: scale(0.98);
        }

        .delay-countdown {
            text-align: center;
            font-size: 1.5rem; font-weight: 900;
            color: #6BADE8;
            padding: 16px 0;
            animation: pulse-count 1s ease infinite;
        }
        @keyframes pulse-count {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.7; }
        }

        /* â”€â”€ ë°˜ì‘í˜•: ëª¨ë°”ì¼ (ê¸°ë³¸ê°’ ê°•í™”) â”€â”€ */
        @media (max-width: 374px) {
            .app { padding: 16px 10px; }
            .slot { border-radius: 8px; font-size: 0.9rem; }
            .num-chip { width: 29px; height: 29px; font-size: 0.65rem; }
            .quiz-card { width: 56px; height: 56px; font-size: 1.15rem; border-radius: 12px; }
            .quiz-cards-8 .quiz-card { width: 44px; height: 44px; font-size: 1rem; border-radius: 10px; }
            .quiz-chip { width: 48px; height: 48px; font-size: 1.05rem; }
            .floating-num { width: 36px; height: 36px; font-size: 0.78rem; }
        }

        /* â”€â”€ ë°˜ì‘í˜•: íƒœë¸”ë¦¿ (768px+) â”€â”€ */
        @media (min-width: 768px) {
            body { align-items: center; padding: 32px; }
            .app {
                max-width: 720px; min-height: auto;
                border-radius: 32px;
                box-shadow: 0 8px 48px rgba(0,0,0,0.07), 0 1px 4px rgba(0,0,0,0.04);
                padding: 40px 36px;
            }
            .game-section { padding: 20px; border-radius: 22px; }
            .game-section-title { font-size: 1.15rem; }
            .settings-group { border-radius: 14px; }
            .settings-label { width: 44px; font-size: 0.75rem; }
            .settings-options .counting-mode-btn { font-size: 0.82rem; padding: 10px 0; }
            .btn-home { width: 44px; height: 44px; border-radius: 12px; }
            .btn-home svg { width: 22px; height: 22px; }
            .progress-track { height: 10px; }
            .mode-card { padding: 20px !important; }
            .mode-card p:first-child { font-size: 1.4rem !important; }
            .mode-card p:last-child { font-size: 0.85rem !important; }
            .slots-grid { gap: 6px; }
            .slot { border-radius: 14px; font-size: 1.3rem; border-width: 3px; }
            .num-chip { width: 42px; height: 42px; font-size: 0.91rem; }
            .floating-num { width: 47px; height: 47px; font-size: 1.04rem; border-radius: 12px; }
            .quiz-card { width: 80px; height: 80px; font-size: 1.7rem; border-radius: 18px; }
            .quiz-cards-8 .quiz-card { width: 72px; height: 72px; font-size: 1.4rem; border-radius: 16px; }
            .quiz-chip { width: 68px; height: 68px; font-size: 1.4rem; }
            #quiz-chips { gap: 16px !important; }
            .impulse-toggle { padding: 16px 20px; border-radius: 20px; }
            .delay-btn { min-width: 44px; height: 36px; font-size: 0.85rem; }
            .delay-countdown { font-size: 1.8rem; }
        }

        /* â”€â”€ ë°˜ì‘í˜•: í° íƒœë¸”ë¦¿ (1024px+) â”€â”€ */
        @media (min-width: 1024px) {
            .app { max-width: 800px; padding: 48px 44px; }
            .mode-card p:first-child { font-size: 1.6rem !important; }
            .slot { font-size: 1.4rem; }
            .num-chip { width: 47px; height: 47px; font-size: 0.98rem; }
            .quiz-card { width: 90px; height: 90px; font-size: 1.9rem; }
            .quiz-cards-8 .quiz-card { width: 80px; height: 80px; font-size: 1.55rem; }
            .quiz-chip { width: 76px; height: 76px; font-size: 1.55rem; }
        }
    </style>
</head>
<body>

<div class="app">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì‹œì‘ í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="start-view" class="flex flex-col flex-1">
        <div class="text-center pt-2 pb-3">
            <div class="inline-block mb-2">
                <svg viewBox="0 0 120 100" width="90" height="75" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <ellipse cx="30" cy="72" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(-20 30 72)"/>
                    <ellipse cx="78" cy="76" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(15 78 76)"/>
                    <ellipse cx="28" cy="54" rx="9" ry="5.5" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(-10 28 54)"/>
                    <path d="M18 60 L10 55" stroke="#F2DC8C" stroke-width="4" stroke-linecap="round"/>
                    <ellipse cx="55" cy="58" rx="35" ry="20" fill="#F5E6C8" stroke="#3A9B6A" stroke-width="2"/>
                    <ellipse cx="52" cy="42" rx="32" ry="28" fill="#7EDCAA" stroke="#3A9B6A" stroke-width="2.5"/>
                    <path d="M52 18 L42 32 L42 48 L52 58 L62 48 L62 32 Z" fill="none" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="42" y1="32" x2="24" y2="38" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="62" y1="32" x2="80" y2="38" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="42" y1="48" x2="26" y2="56" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="62" y1="48" x2="78" y2="56" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <ellipse cx="42" cy="26" rx="6" ry="4" fill="white" opacity="0.35" transform="rotate(-15 42 26)"/>
                    <ellipse cx="62" cy="36" rx="4" ry="3" fill="white" opacity="0.2"/>
                    <ellipse cx="92" cy="40" rx="17" ry="15" fill="#F5E6C8" stroke="#3A9B6A" stroke-width="2.5"/>
                    <ellipse cx="82" cy="72" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(10 82 72)"/>
                    <circle cx="99" cy="35" r="4" fill="white" stroke="#3A9B6A" stroke-width="1.5"/>
                    <circle cx="100" cy="34" r="2.5" fill="#3A9B6A"/>
                    <circle cx="101" cy="33" r="1" fill="white"/>
                    <circle cx="100" cy="44" r="3.5" fill="#F0A050" opacity="0.4"/>
                    <path d="M94 46 Q98 50 103 46" fill="none" stroke="#3A9B6A" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            <h1 class="text-2xl font-black tracking-tight">
                <span style="color:#2E7FD9;">ëŠë¦°</span><span style="color:#F0901E;">ì•„ì´</span> <span style="color:#4A4035;">ìˆ«ì</span>
            </h1>
        </div>

        <div style="height:8px;"></div>

        <div class="flex flex-col gap-3 flex-1">
            <!-- ìˆ«ì ìˆœì„œ ë§ì¶”ê¸° -->
            <div class="game-section">
                <div class="game-section-header">
                    <div class="icon-order">
                        <div class="slot-box"><span class="num-fill">1</span></div>
                        <div class="slot-box"><span class="num-fill">2</span></div>
                        <div class="slot-box"><span class="num-fill">3</span></div>
                    </div>
                    <span class="game-section-title">ìˆ«ì ìˆœì„œ ë§ì¶”ê¸°</span>
                    <span class="game-section-desc">ëŒì–´ì„œ ë¹ˆì¹¸ ì±„ìš°ê¸°</span>
                </div>
                <div class="settings-group">
                    <div class="settings-row">
                        <span class="settings-label">ì½ê¸°</span>
                        <div class="settings-options">
                            <button onclick="setCountingMode('sino')" data-cmode="sino"
                                    class="counting-mode-btn selected">ì¼, ì´, ì‚¼</button>
                            <button onclick="setCountingMode('native')" data-cmode="native"
                                    class="counting-mode-btn">í•˜ë‚˜, ë‘˜, ì…‹</button>
                        </div>
                    </div>
                    <div class="settings-row">
                        <span class="settings-label">ìˆœì„œ</span>
                        <div class="settings-options">
                            <button onclick="setOrderMode('asc')" data-omode="asc"
                                    class="counting-mode-btn selected">1, 2, 3 ì •ë°©í–¥</button>
                            <button onclick="setOrderMode('desc')" data-omode="desc"
                                    class="counting-mode-btn">10, 9, 8 ì—­ë°©í–¥</button>
                        </div>
                    </div>
                    <div class="settings-row">
                        <span class="settings-label">ë¹ˆì¹¸</span>
                        <div class="settings-options">
                            <button onclick="setGhostMode(false)" data-gmode="off"
                                    class="counting-mode-btn selected">íŒíŠ¸ ìˆ¨ê¹€</button>
                            <button onclick="setGhostMode(true)" data-gmode="on"
                                    class="counting-mode-btn">íŒíŠ¸ ë³´ì„</button>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="startGame(5)" data-range="5"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 5</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ë°˜ ì¤„</p>
                    </button>
                    <button onclick="startGame(10)" data-range="10"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 10</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">í•œ ì¤„</p>
                    </button>
                    <button onclick="startGame(20)" data-range="20"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 20</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ë‘ ì¤„</p>
                    </button>
                    <button onclick="startGame(30)" data-range="30"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 30</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ì„¸ ì¤„</p>
                    </button>
                    <button onclick="startGame(50)" data-range="50"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 50</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ë‹¤ì„¯ ì¤„</p>
                    </button>
                    <button onclick="startGame(100)" data-range="100"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 100</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ì—´ ì¤„</p>
                    </button>
                </div>
            </div>

            <!-- ë¹ˆì¹¸ ë§ì¶”ê¸° -->
            <div class="game-section">
                <div class="game-section-header">
                    <div class="icon-blank">
                        <div class="ib-card ib-fixed">1</div>
                        <div class="ib-card ib-empty"><span class="ib-q">?</span><span class="ib-ans">2</span></div>
                        <div class="ib-card ib-fixed">3</div>
                    </div>
                    <span class="game-section-title">ë¹ˆì¹¸ ë§ì¶”ê¸°</span>
                    <span class="game-section-desc">ìˆ¨ì€ ìˆ«ìë¥¼ ì°¾ì•„ìš”</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="startQuiz(5)" data-range="5"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 5</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">5ê°œ ì¤‘ 2ê°œ ìˆ¨ê¹€</p>
                    </button>
                    <button onclick="startQuiz(10)" data-range="10"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 10</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8ê°œ ì¤‘ 4ê°œ ìˆ¨ê¹€</p>
                    </button>
                    <button onclick="startQuiz(20)" data-range="20"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 20</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8ê°œ ì¤‘ 4ê°œ ìˆ¨ê¹€</p>
                    </button>
                    <button onclick="startQuiz(30)" data-range="30"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 30</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8ê°œ ì¤‘ 4ê°œ ìˆ¨ê¹€</p>
                    </button>
                    <button onclick="startQuiz(50)" data-range="50"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 50</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8ê°œ ì¤‘ 4ê°œ ìˆ¨ê¹€</p>
                    </button>
                    <button onclick="startQuiz(100)" data-range="100"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 ë¶€í„° 100</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8ê°œ ì¤‘ 4ê°œ ìˆ¨ê¹€</p>
                    </button>
                </div>
            </div>

            <div style="margin-top: auto;"></div>

            <!-- ìŒì„± + ì¶©ë™ë°©ì§€ -->
            <div class="flex gap-2">
                <div class="impulse-toggle flex-1" id="tts-toggle" onclick="toggleTTS()">
                    <div class="toggle-switch on" id="tts-switch"></div>
                    <div>
                        <p style="font-size:0.81rem; font-weight:600; color:#4A4035;">ìŒì„±</p>
                        <p style="font-size:0.68rem; color:#B8AD9E;">ì •ë‹µ/ì˜¤ë‹µ ìŒì„± ì•ˆë‚´</p>
                    </div>
                </div>
            </div>

            <div style="margin-top: -6px;">
                <div class="impulse-toggle active" id="impulse-toggle" onclick="toggleImpulse()">
                    <div class="toggle-switch on" id="impulse-switch"></div>
                    <div>
                        <p style="font-size:0.81rem; font-weight:600; color:#4A4035;">ì¶©ë™ë°©ì§€</p>
                        <p style="font-size:0.68rem; color:#B8AD9E;">ìƒê°í•  ì‹œê°„ì„ ì¤˜ìš”</p>
                    </div>
                </div>
                <div class="impulse-details show" id="impulse-details">
                <div class="impulse-mode-options">
                    <button class="impulse-mode-btn" onclick="setImpulseMode('hide')" data-mode="hide">
                        <span class="impulse-mode-icon">ğŸ‘€</span>
                        <span class="impulse-mode-label">ë³´ê¸° í™•ì¸</span>
                        <span class="impulse-mode-desc">ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë³´ê¸°ê°€ ë‚˜íƒ€ë‚˜ìš”</span>
                    </button>
                    <button class="impulse-mode-btn selected" onclick="setImpulseMode('lock')" data-mode="lock">
                        <span class="impulse-mode-icon">ğŸ”’</span>
                        <span class="impulse-mode-label">ì„ íƒ ì ê¸ˆ</span>
                        <span class="impulse-mode-desc">Nì´ˆ ë™ì•ˆ ì„ íƒí•  ìˆ˜ ì—†ì–´ìš”</span>
                    </button>
                </div>
                <div class="delay-options show">
                    <button class="delay-btn" onclick="setDelay(1)" data-delay="1">1ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(2)" data-delay="2">2ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(3)" data-delay="3">3ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(4)" data-delay="4">4ì´ˆ</button>
                    <button class="delay-btn selected" onclick="setDelay(5)" data-delay="5">5ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(6)" data-delay="6">6ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(7)" data-delay="7">7ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(8)" data-delay="8">8ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(9)" data-delay="9">9ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(10)" data-delay="10">10ì´ˆ</button>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ê²Œì„ í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="game-view" class="hidden flex flex-col flex-1 fade-in">
        <!-- ìƒë‹¨ ë°” -->
        <div class="flex items-center gap-3 mb-4">
            <button onclick="goHome()" class="btn-home" title="í™ˆ">
                <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-8 9 8M5 11v9a1 1 0 001 1h3m8 0h3a1 1 0 001-1v-9"/></svg>
            </button>
            <div class="flex-1">
                <div class="flex justify-between items-center mb-1">
                    <span id="game-label" class="text-xs font-medium" style="color:#B8AD9E;">1 ë¶€í„° 10</span>
                    <span id="placed-label" class="text-xs font-medium" style="color:#B8AD9E;">0 / 10</span>
                </div>
                <div class="progress-track">
                    <div id="progress" class="progress-bar" style="width:0%"></div>
                </div>
            </div>
        </div>

        <!-- ì•ˆë‚´ -->
        <p id="hint-text" class="text-center text-sm mb-4 font-medium" style="color:#6BADE8;">
            ìˆ«ìë¥¼ ìˆœì„œëŒ€ë¡œ ë¹ˆì¹¸ì— ë†“ì•„ë´ìš”
        </p>

        <!-- ìŠ¬ë¡¯ ì˜ì—­ (10ì¹¸ í•œ ì¤„) -->
        <div id="slots" class="slots-grid mb-5"></div>

        <!-- êµ¬ë¶„ì„  -->
        <div class="mb-2" style="border-top:1.5px solid #F0ECE6;"></div>

        <!-- ìˆ«ì ì¹© ì˜ì—­ (í©ë¿Œë¦¬ê¸°) -->
        <p class="text-center text-xs mb-2 mt-2" style="color:#D0C8BC;">ì•„ë˜ ìˆ«ìë¥¼ ìœ„ ë¹ˆì¹¸ìœ¼ë¡œ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</p>
        <div id="chips" class="scatter-area"></div>

        <!-- í”¼ë“œë°± -->
        <div id="feedback" class="text-center h-8 text-base font-bold mt-4" style="color:#4A4035;"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë¹ˆì¹¸ ë§ì¶”ê¸° í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="quiz-view" class="hidden flex flex-col flex-1 fade-in">
        <div class="flex items-center gap-3 mb-4">
            <button onclick="goHome()" class="btn-home" title="í™ˆ">
                <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-8 9 8M5 11v9a1 1 0 001 1h3m8 0h3a1 1 0 001-1v-9"/></svg>
            </button>
            <div class="flex-1">
                <div class="flex justify-between items-center mb-1">
                    <span id="quiz-label" class="text-xs font-medium" style="color:#B8AD9E;">ë¬¸ì œ 1 / 5</span>
                    <span class="text-xs font-medium" style="color:#B8AD9E;">ë§íŒ ë¬¸ì œ: <span id="quiz-score" style="color:#5BC886;">0</span></span>
                </div>
                <div class="progress-track">
                    <div id="quiz-progress" class="progress-bar" style="width:0%"></div>
                </div>
            </div>
        </div>

        <p id="quiz-hint" class="text-center text-sm mb-5 font-medium" style="color:#6BADE8;">
            ìˆ¨ì€ ìˆ«ìë¥¼ ì°¾ì•„ì„œ ë¹ˆì¹¸ì— ë†“ì•„ë´ìš”
        </p>

        <!-- ì¹´ë“œ ì¤„ -->
        <div id="quiz-cards" class="flex justify-center gap-2 mb-8"></div>

        <!-- êµ¬ë¶„ì„  -->
        <div class="mb-4" style="border-top:1.5px solid #F0ECE6;"></div>

        <!-- ì„ íƒì§€ ì¹© -->
        <p class="text-center text-xs mb-3" style="color:#D0C8BC;">ìˆ¨ì€ ìˆ«ìë¥¼ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</p>
        <div id="quiz-chips" class="flex justify-center gap-3 flex-wrap"></div>

        <div id="quiz-feedback" class="text-center h-8 text-base font-bold mt-6" style="color:#4A4035;"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ê²°ê³¼ í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="result-view" class="hidden flex flex-col flex-1 fade-in">
        <div class="flex-1 flex flex-col justify-center">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ†</div>
                <h2 class="text-2xl font-bold" style="color:#4A4035;">ë‹¤ ë§í˜”ì–´ìš”!</h2>
                <p class="text-sm mt-2" style="color:#B8AD9E;">ìˆ«ì ìˆœì„œë¥¼ ì˜ ì•Œê³  ìˆì–´ìš”</p>
            </div>
            <div class="flex flex-col gap-3 mb-8">
                <div class="flex justify-between items-center rounded-2xl p-4" style="background:#F5FAFF; border:1.5px solid #D9EDFC;">
                    <span class="text-sm" style="color:#6B5F50;">ë²”ìœ„</span>
                    <span id="r-range" class="text-lg font-bold" style="color:#4A8FC2;">1 ë¶€í„° 10</span>
                </div>
                <div class="flex justify-between items-center rounded-2xl p-4" style="background:#FFFAF2; border:1.5px solid #F5D5A8;">
                    <span class="text-sm" style="color:#6B5F50;">ê±¸ë¦° ì‹œê°„</span>
                    <span id="r-time" class="text-lg font-bold" style="color:#C07830;">0ì´ˆ</span>
                </div>
                <div class="flex justify-between items-center rounded-2xl p-4" style="background:#FDE8E8; border:1.5px solid #F5B8B8;">
                    <span class="text-sm" style="color:#6B5F50;">í‹€ë¦° íšŸìˆ˜</span>
                    <span id="r-wrong" class="text-lg font-bold" style="color:#D04040;">0ë²ˆ</span>
                </div>
            </div>
        </div>
        <div class="flex gap-3">
            <button onclick="goHome()"
                    class="flex-1 py-3.5 rounded-2xl font-bold text-sm border-2 transition hover:opacity-90 active:scale-[0.98]"
                    style="border-color:#E8E2DA; color:#6B5F50; background:white;">
                í™ˆìœ¼ë¡œ
            </button>
            <button onclick="replay()"
                    class="flex-1 py-3.5 rounded-2xl font-bold text-sm border-2 transition hover:opacity-90 active:scale-[0.98]"
                    style="border-color:#6BADE8; color:#2E7FD9; background:#EEF6FD;">
                ë‹¤ì‹œ í•˜ê¸°
            </button>
        </div>
    </div>
</div>

<script>
    let maxNum = 10;
    let nextExpected = 1;
    let lastMode = null;  // 'game', 'quiz'
    let lastRange = 10;
    let placedCount = 0;
    let wrongCount = 0;
    let startTime = 0;

    // ë“œë˜ê·¸ ìƒíƒœ
    let dragging = false;
    let dragValue = null;
    let dragChipEl = null;
    let floatingEl = null;

    // ì½ê¸° ëª¨ë“œ
    let countingMode = 'sino'; // 'native' = í•˜ë‚˜ë‘˜ì…‹, 'sino' = ì¼ì´ì‚¼

    function setCountingMode(mode) {
        countingMode = mode;
        document.querySelectorAll('[data-cmode]').forEach(b => {
            b.classList.toggle('selected', b.dataset.cmode === mode);
        });
    }

    // ì •ìˆœ/ì—­ìˆœ ëª¨ë“œ
    let reverseMode = false; // false = ì •ìˆœ(1â†’N), true = ì—­ìˆœ(Nâ†’1)

    function setOrderMode(mode) {
        reverseMode = (mode === 'desc');
        document.querySelectorAll('[data-omode]').forEach(b => {
            b.classList.toggle('selected', b.dataset.omode === mode);
        });
    }

    // ë¹ˆì¹¸ íŒíŠ¸ ëª¨ë“œ
    let ghostMode = false; // false = ë¹ˆì¹¸ ìˆ¨ê¹€, true = ë¹ˆì¹¸ íŒíŠ¸(íë¦¬ê²Œ í‘œì‹œ)

    function setGhostMode(enabled) {
        ghostMode = enabled;
        document.querySelectorAll('[data-gmode]').forEach(b => {
            b.classList.toggle('selected', (enabled && b.dataset.gmode === 'on') || (!enabled && b.dataset.gmode === 'off'));
        });
    }

    function nativeKorean(n) {
        if (n === 100) return 'ë°±';
        const ones = ['', 'í•˜ë‚˜', 'ë‘˜', 'ì…‹', 'ë„·', 'ë‹¤ì„¯', 'ì—¬ì„¯', 'ì¼ê³±', 'ì—¬ëŸ', 'ì•„í™‰'];
        const tens = ['', 'ì—´', 'ìŠ¤ë¬¼', 'ì„œë¥¸', 'ë§ˆí”', 'ì‰°', 'ì˜ˆìˆœ', 'ì¼í”', 'ì—¬ë“ ', 'ì•„í”'];
        const t = Math.floor(n / 10);
        const o = n % 10;
        return tens[t] + ones[o];
    }

    function sinoKorean(n) {
        if (n === 100) return 'ë°±';
        const ones = ['', 'ì¼', 'ì´', 'ì‚¼', 'ì‚¬', 'ì˜¤', 'ìœ¡', 'ì¹ ', 'íŒ”', 'êµ¬'];
        if (n <= 0) return '';
        const t = Math.floor(n / 10);
        const o = n % 10;
        let result = '';
        if (t >= 2) result += ones[t];
        if (t >= 1) result += 'ì‹­';
        result += ones[o];
        return result;
    }

    function countingWord(n) {
        return countingMode === 'native' ? nativeKorean(n) : sinoKorean(n);
    }

    // ìŒì„±
    let ttsEnabled = true;
    function toggleTTS() {
        ttsEnabled = !ttsEnabled;
        const tog = document.getElementById('tts-toggle');
        const sw = document.getElementById('tts-switch');
        tog.classList.toggle('active', ttsEnabled);
        sw.classList.toggle('on', ttsEnabled);
        if (!ttsEnabled && window.speechSynthesis) window.speechSynthesis.cancel();
    }

    // ì¶©ë™ë°©ì§€
    let impulseEnabled = true;
    let impulseDelay = 5;
    let impulseMode = 'lock'; // 'hide' = ë³´ê¸° í™•ì¸, 'lock' = ì„ íƒ ì ê¸ˆ
    let impulseTimer = null;

    function toggleImpulse() {
        impulseEnabled = !impulseEnabled;
        document.getElementById('impulse-switch').classList.toggle('on', impulseEnabled);
        document.getElementById('impulse-toggle').classList.toggle('active', impulseEnabled);
        document.getElementById('impulse-details').classList.toggle('show', impulseEnabled);
    }

    function setImpulseMode(mode) {
        impulseMode = mode;
        document.querySelectorAll('.impulse-mode-btn').forEach(b => {
            b.classList.toggle('selected', b.dataset.mode === mode);
        });
    }

    function setDelay(sec) {
        impulseDelay = sec;
        document.querySelectorAll('.delay-btn').forEach(b => {
            b.classList.toggle('selected', parseInt(b.dataset.delay) === sec);
        });
    }

    function applyImpulseDelay(chipsEl, countdownParent) {
        if (!impulseEnabled) return;

        if (impulseMode === 'hide') {
            chipsEl.classList.add('chips-hidden');
            const revealBtn = document.createElement('button');
            revealBtn.className = 'reveal-btn';
            revealBtn.id = 'revealBtn';
            revealBtn.textContent = 'ë³´ê¸° í™•ì¸';
            revealBtn.addEventListener('click', () => {
                chipsEl.classList.remove('chips-hidden');
                revealBtn.remove();
            });
            countdownParent.insertBefore(revealBtn, chipsEl);
        } else {
            chipsEl.classList.add('chips-locked');
            const cdEl = document.createElement('div');
            cdEl.className = 'delay-countdown';
            cdEl.id = 'impulse-countdown';
            countdownParent.insertBefore(cdEl, chipsEl);

            let remaining = impulseDelay;
            cdEl.textContent = `${remaining}ì´ˆ ë™ì•ˆ ìƒê°í•´ ë³´ì„¸ìš”`;

            impulseTimer = setInterval(() => {
                remaining--;
                if (remaining <= 0) {
                    clearInterval(impulseTimer);
                    impulseTimer = null;
                    cdEl.remove();
                    chipsEl.classList.remove('chips-locked');
                } else {
                    cdEl.textContent = `${remaining}ì´ˆ ë™ì•ˆ ìƒê°í•´ ë³´ì„¸ìš”`;
                }
            }, 1000);
        }
    }

    function clearImpulseTimer() {
        if (impulseTimer) { clearInterval(impulseTimer); impulseTimer = null; }
        const cd = document.getElementById('impulse-countdown');
        if (cd) cd.remove();
        const oldReveal = document.getElementById('revealBtn');
        if (oldReveal) oldReveal.remove();
        // ì”ì—¬ í´ë˜ìŠ¤ ì •ë¦¬
        document.querySelectorAll('.chips-hidden, .chips-locked').forEach(el => {
            el.classList.remove('chips-hidden', 'chips-locked');
        });
    }

    function startGame(range) {
        lastMode = 'game';
        lastRange = range;
        maxNum = range;
        nextExpected = reverseMode ? maxNum : 1;
        placedCount = 0;
        wrongCount = 0;
        startTime = Date.now();

        document.getElementById('start-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('game-view').classList.remove('hidden');

        const modeLabel = reverseMode ? `${maxNum} â†’ 1 ì—­ìˆœ` : `1 ~ ${maxNum}`;
        document.getElementById('game-label').textContent = modeLabel;
        document.getElementById('feedback').textContent = '';
        updateProgress();

        // ìŠ¬ë¡¯ ìƒì„±
        const slotsEl = document.getElementById('slots');
        slotsEl.innerHTML = '';
        const gridCols = maxNum <= 5 ? 5 : 10;
        slotsEl.style.gridTemplateColumns = `repeat(${gridCols}, 1fr)`;
        slotsEl.style.fontSize = maxNum >= 100 ? '0.7rem' : '';
        for (let idx = 0; idx < maxNum; idx++) {
            const num = reverseMode ? (maxNum - idx) : (idx + 1);
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.num = num;
            if (ghostMode) {
                const ghost = document.createElement('span');
                ghost.className = 'ghost-num';
                ghost.textContent = num;
                slot.appendChild(ghost);
            }
            slotsEl.appendChild(slot);
        }

        // ì¹© ìƒì„± (ëœë¤ ìœ„ì¹˜ì— í©ë¿Œë¦¬ê¸°)
        const nums = [];
        for (let i = 1; i <= maxNum; i++) nums.push(i);
        shuffle(nums);

        const chipsEl = document.getElementById('chips');
        chipsEl.innerHTML = '';
        // í©ë¿Œë¦¬ê¸° ì˜ì—­ ë†’ì´ ê³„ì‚°
        const isTablet = window.innerWidth >= 768;
        const chipPx = isTablet ? 44 : 36;
        const gap = Math.round(chipPx * 0.3);
        const cellSize = chipPx + gap;
        const areaW = chipsEl.offsetWidth || 500;
        const cols = Math.max(1, Math.floor(areaW / cellSize));
        const minRows = Math.ceil(nums.length / cols);
        const totalRows = minRows + Math.max(1, Math.round(minRows * 0.15));
        const scatterH = totalRows * cellSize;
        chipsEl.style.minHeight = scatterH + 'px';

        // ê²¹ì¹¨ ë°©ì§€ë¥¼ ìœ„í•œ ìœ„ì¹˜ ê³„ì‚°
        const positions = scatterPositions(nums.length, areaW, scatterH, chipPx);

        nums.forEach((n, idx) => {
            const chip = document.createElement('div');
            chip.className = 'num-chip';
            chip.textContent = n;
            chip.dataset.num = n;
            chip.style.left = positions[idx].x + 'px';
            chip.style.top = positions[idx].y + 'px';
            bindDrag(chip, n);
            chipsEl.appendChild(chip);
        });

        updateHint();

        // TTS ì´ˆê¸°í™”
        if (window.speechSynthesis) speechSynthesis.speak(new SpeechSynthesisUtterance(''));
        setTimeout(() => speak('ì²œì²œíˆ ìƒê°í•˜ê³  í’€ì–´ë³´ì„¸ìš”.'), 100);

        // ì¶©ë™ë°©ì§€
        applyImpulseDelay(chipsEl, chipsEl.parentElement);
    }

    function bindDrag(chip, value) {
        chip.addEventListener('mousedown', e => {
            e.preventDefault();
            beginDrag(chip, value, e.clientX, e.clientY);
        });
        chip.addEventListener('touchstart', e => {
            e.preventDefault();
            const t = e.touches[0];
            beginDrag(chip, value, t.clientX, t.clientY);
        }, { passive: false });
    }

    function beginDrag(chip, value, x, y) {
        if (dragging) return;
        dragging = true;
        dragValue = value;
        dragChipEl = chip;
        chip.classList.add('dragging');

        floatingEl = document.createElement('div');
        floatingEl.className = 'floating-num';
        floatingEl.textContent = value;
        floatingEl.style.left = x + 'px';
        floatingEl.style.top = y + 'px';
        document.body.appendChild(floatingEl);

        highlightTarget(x, y);
    }

    function isQuizMode() {
        return !document.getElementById('quiz-view').classList.contains('hidden');
    }

    function moveHandler(x, y) {
        if (!dragging || !floatingEl) return;
        floatingEl.style.left = x + 'px';
        floatingEl.style.top = y + 'px';
        if (isQuizMode()) highlightQuizTarget(x, y);
        else highlightTarget(x, y);
    }

    function endHandler(x, y) {
        if (!dragging) return;

        if (isQuizMode()) {
            endQuizDrag(x, y);
            return;
        }

        // ì–´ë–¤ ìŠ¬ë¡¯ ìœ„ì¸ì§€ í™•ì¸
        const target = getSlotAt(x, y);
        clearHighlights();

        if (target && !target.classList.contains('filled')) {
            const slotNum = parseInt(target.dataset.num);
            if (dragValue === slotNum && dragValue === nextExpected) {
                // ì •ë‹µ
                placeNumber(target, dragValue);
            } else {
                // ì˜¤ë‹µ
                wrongCount++;
                target.classList.add('wrong');
                setTimeout(() => target.classList.remove('wrong'), 400);
                const fb = document.getElementById('feedback');
                if (dragValue !== nextExpected) {
                    fb.textContent = `${nextExpected}ì„ ë¨¼ì € ë†“ì•„ì•¼ í•´ìš”`;
                } else {
                    fb.textContent = 'ì´ ì¹¸ì€ ë‹¤ë¥¸ ìˆ«ì ìë¦¬ì˜ˆìš”';
                }
                fb.style.color = '#F07070';
                speak('ë‹¤ì‹œ í•´ë´ìš”.');
            }
        }

        // ì •ë¦¬
        if (floatingEl) { floatingEl.remove(); floatingEl = null; }
        if (dragChipEl) dragChipEl.classList.remove('dragging');
        dragging = false;
        dragValue = null;
        dragChipEl = null;
    }

    function placeNumber(slot, value) {
        slot.innerHTML = '';
        slot.textContent = value;
        slot.classList.add('filled', 'pop-in');
        slot.style.fontSize = '1.25rem';

        // ì¹© ìˆ¨ê¸°ê¸°
        dragChipEl.classList.add('placed');

        placedCount++;
        if (reverseMode) {
            nextExpected--;
        } else {
            nextExpected++;
        }
        updateProgress();
        updateHint();

        const fb = document.getElementById('feedback');

        if (placedCount >= maxNum) {
            fb.textContent = 'ì™„ì„±! ğŸ‰';
            fb.style.color = '#5BC886';
            speak('ë‹¤ ë§í˜”ì–´ìš”! ì •ë§ ì˜í–ˆì–´ìš”.');
            setTimeout(showResult, 1500);
        } else {
            fb.textContent = 'ì˜í–ˆì–´ìš”!';
            fb.style.color = '#5BC886';
            speak(countingWord(value));
            setTimeout(() => {
                if (fb.textContent === 'ì˜í–ˆì–´ìš”!') {
                    fb.textContent = '';
                }
            }, 800);
        }
    }

    function highlightTarget(x, y) {
        clearHighlights();
        const target = getSlotAt(x, y);
        if (target && !target.classList.contains('filled')) {
            target.classList.add('drag-over');
        }
    }

    function clearHighlights() {
        document.querySelectorAll('.slot.drag-over').forEach(s => s.classList.remove('drag-over'));
    }

    function getSlotAt(x, y) {
        const slots = document.querySelectorAll('.slot');
        for (const slot of slots) {
            const r = slot.getBoundingClientRect();
            if (x >= r.left && x <= r.right && y >= r.top && y <= r.bottom) {
                return slot;
            }
        }
        return null;
    }

    function updateProgress() {
        document.getElementById('placed-label').textContent = `${placedCount} / ${maxNum}`;
        document.getElementById('progress').style.width = `${(placedCount / maxNum) * 100}%`;
    }

    function updateHint() {
        const hint = document.getElementById('hint-text');
        if (placedCount >= maxNum) {
            hint.textContent = 'ì™„ì„±!';
            hint.style.color = '#5BC886';
        } else {
            const direction = reverseMode ? '(ì—­ìˆœ) ' : '';
            hint.textContent = `${direction}ë‹¤ìŒ ìˆ«ì: ${nextExpected}`;
            hint.style.color = '#6BADE8';
        }
    }

    function showResult() {
        const sec = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById('game-view').classList.add('hidden');
        document.getElementById('result-view').classList.remove('hidden');
        const rangeText = reverseMode ? `${maxNum} â†’ 1 ì—­ìˆœ` : `1 ~ ${maxNum}`;
        document.getElementById('r-range').textContent = rangeText;
        document.getElementById('r-time').textContent = `${sec}ì´ˆ`;
        document.getElementById('r-wrong').textContent = `${wrongCount}ë²ˆ`;
    }

    function replay() {
        document.getElementById('result-view').classList.add('hidden');
        if (lastMode === 'game') startGame(lastRange);
        else if (lastMode === 'quiz') startQuiz(lastRange);
        else goHome();
    }

    function goHome() {
        clearImpulseTimer();
        if (floatingEl) { floatingEl.remove(); floatingEl = null; }
        dragging = false;
        document.getElementById('game-view').classList.add('hidden');
        document.getElementById('quiz-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('start-view').classList.remove('hidden');
    }

    // â”€â”€ ë¹ˆì¹¸ ë§ì¶”ê¸° ëª¨ë“œ â”€â”€
    const QUIZ_TOTAL = 5;
    let quizRound = 0;
    let quizCorrect = 0;
    let quizWrong = 0;
    let quizStartTime = 0;
    let quizNumbers = [];      // ì •ë ¬ëœ 6ê°œ ìˆ«ì
    let quizHiddenSet = null;  // ìˆ¨ê¸´ 3ê°œ Set
    let quizNextHidden = null; // ì™¼ìª½ë¶€í„° ë§ì¶œ ë‹¤ìŒ ìˆ¨ê¸´ ìˆ«ì
    let quizHiddenOrder = [];  // ìˆ¨ê¸´ ìˆ«ì ì™¼â†’ì˜¤ ìˆœì„œ
    let quizPlacedInRound = 0;
    let quizFirstTryInRound = true;
    let quizRange = 10;

    function startQuiz(range) {
        lastMode = 'quiz';
        lastRange = range;
        quizRange = range;
        quizRound = 0;
        quizCorrect = 0;
        quizWrong = 0;
        quizStartTime = Date.now();

        document.getElementById('start-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('quiz-view').classList.remove('hidden');

        if (window.speechSynthesis) speechSynthesis.speak(new SpeechSynthesisUtterance(''));
        nextQuizRound();
    }

    function nextQuizRound() {
        quizRound++;
        quizPlacedInRound = 0;
        quizFirstTryInRound = true;

        document.getElementById('quiz-label').textContent = `ë¬¸ì œ ${quizRound} / ${QUIZ_TOTAL}`;
        document.getElementById('quiz-progress').style.width = `${(quizRound - 1) / QUIZ_TOTAL * 100}%`;
        document.getElementById('quiz-score').textContent = quizCorrect;
        document.getElementById('quiz-feedback').textContent = '';
        document.getElementById('quiz-hint').textContent = 'ìˆ¨ì€ ìˆ«ìë¥¼ ì°¾ì•„ì„œ ë¹ˆì¹¸ì— ë†“ì•„ë´ìš”';
        document.getElementById('quiz-hint').style.color = '#6BADE8';

        const cardCount = quizRange <= 5 ? 5 : 8;
        const hideCount = quizRange <= 5 ? 2 : 4;

        const maxStart = quizRange - cardCount + 1;
        const start = Math.floor(Math.random() * maxStart) + 1;
        quizNumbers = [];
        for (let i = start; i < start + cardCount; i++) quizNumbers.push(i);

        // ìˆ¨ê¸°ê¸°
        const indices = [];
        for (let i = 0; i < cardCount; i++) indices.push(i);
        shuffle(indices);
        const hiddenIndices = new Set(indices.slice(0, hideCount));
        quizHiddenSet = new Set();
        quizHiddenOrder = [];
        quizNumbers.forEach((n, i) => {
            if (hiddenIndices.has(i)) {
                quizHiddenSet.add(n);
                quizHiddenOrder.push(n);
            }
        });
        quizNextHidden = quizHiddenOrder[0];

        // ì¹´ë“œ ë Œë”ë§
        const cardsEl = document.getElementById('quiz-cards');
        cardsEl.innerHTML = '';
        cardsEl.classList.toggle('quiz-cards-8', cardCount >= 8);
        quizNumbers.forEach((n, i) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            if (hiddenIndices.has(i)) {
                card.classList.add('hidden-card');
                card.textContent = '?';
                card.dataset.num = n;
            } else {
                card.classList.add('open');
                card.textContent = n;
            }
            cardsEl.appendChild(card);
        });

        // ì¹© ë Œë”ë§ (ìˆ¨ê¸´ 3ê°œë¥¼ ëœë¤ ìˆœì„œë¡œ)
        const hiddenNums = [...quizHiddenSet];
        shuffle(hiddenNums);
        const chipsEl = document.getElementById('quiz-chips');
        chipsEl.innerHTML = '';
        hiddenNums.forEach(n => {
            const chip = document.createElement('div');
            chip.className = 'quiz-chip';
            chip.textContent = n;
            chip.dataset.num = n;
            bindQuizDrag(chip, n);
            chipsEl.appendChild(chip);
        });

        // ì¶©ë™ë°©ì§€
        clearImpulseTimer();
        applyImpulseDelay(chipsEl, chipsEl.parentElement);
    }

    function bindQuizDrag(chip, value) {
        chip.addEventListener('mousedown', e => {
            e.preventDefault();
            beginQuizDrag(chip, value, e.clientX, e.clientY);
        });
        chip.addEventListener('touchstart', e => {
            e.preventDefault();
            const t = e.touches[0];
            beginQuizDrag(chip, value, t.clientX, t.clientY);
        }, { passive: false });
    }

    function beginQuizDrag(chip, value, x, y) {
        if (dragging) return;
        dragging = true;
        dragValue = value;
        dragChipEl = chip;
        chip.classList.add('dragging');

        floatingEl = document.createElement('div');
        floatingEl.className = 'floating-num';
        floatingEl.textContent = value;
        floatingEl.style.left = x + 'px';
        floatingEl.style.top = y + 'px';
        document.body.appendChild(floatingEl);

        highlightQuizTarget(x, y);
    }

    function highlightQuizTarget(x, y) {
        document.querySelectorAll('.quiz-card.hidden-card.drag-over').forEach(c => c.classList.remove('drag-over'));
        const target = getQuizCardAt(x, y);
        if (target && !target.classList.contains('filled')) {
            target.classList.add('drag-over');
        }
    }

    function getQuizCardAt(x, y) {
        const cards = document.querySelectorAll('.quiz-card.hidden-card');
        for (const card of cards) {
            const r = card.getBoundingClientRect();
            if (x >= r.left && x <= r.right && y >= r.top && y <= r.bottom) {
                return card;
            }
        }
        return null;
    }

    function endQuizDrag(x, y) {
        document.querySelectorAll('.quiz-card.hidden-card.drag-over').forEach(c => c.classList.remove('drag-over'));

        const target = getQuizCardAt(x, y);
        if (target && !target.classList.contains('filled')) {
            const cardNum = parseInt(target.dataset.num);
            if (dragValue === cardNum) {
                // ì •ë‹µ
                target.textContent = cardNum;
                target.classList.add('filled', 'pop-in');
                dragChipEl.classList.add('placed');
                quizPlacedInRound++;

                const fb = document.getElementById('quiz-feedback');

                if (quizPlacedInRound >= quizHiddenOrder.length) {
                    // ì´ ë¼ìš´ë“œ ì™„ì„±
                    if (quizFirstTryInRound) quizCorrect++;
                    document.getElementById('quiz-score').textContent = quizCorrect;
                    document.getElementById('quiz-progress').style.width = `${quizRound / QUIZ_TOTAL * 100}%`;
                    fb.textContent = 'ì •ë‹µì´ì—ìš”! ğŸ‰';
                    fb.style.color = '#5BC886';
                    speak('ì •ë‹µì´ì—ìš”.');

                    if (quizRound >= QUIZ_TOTAL) {
                        setTimeout(showQuizResult, 1500);
                    } else {
                        setTimeout(nextQuizRound, 1300);
                    }
                } else {
                    fb.textContent = 'ì˜í–ˆì–´ìš”!';
                    fb.style.color = '#5BC886';
                    speak(String(cardNum));
                    setTimeout(() => { if (fb.textContent === 'ì˜í–ˆì–´ìš”!') fb.textContent = ''; }, 800);
                }
            } else {
                // ì˜¤ë‹µ
                quizWrong++;
                quizFirstTryInRound = false;
                target.classList.add('wrong');
                setTimeout(() => target.classList.remove('wrong'), 400);
                const fb = document.getElementById('quiz-feedback');
                fb.textContent = 'ì´ ì¹¸ì€ ë‹¤ë¥¸ ìˆ«ì ìë¦¬ì˜ˆìš”';
                fb.style.color = '#F07070';
                speak('ë‹¤ì‹œ í•´ë´ìš”.');
            }
        }

        // ì •ë¦¬
        if (floatingEl) { floatingEl.remove(); floatingEl = null; }
        if (dragChipEl) dragChipEl.classList.remove('dragging');
        dragging = false;
        dragValue = null;
        dragChipEl = null;
    }

    function showQuizResult() {
        const sec = Math.floor((Date.now() - quizStartTime) / 1000);
        document.getElementById('quiz-view').classList.add('hidden');
        document.getElementById('result-view').classList.remove('hidden');
        document.getElementById('r-range').textContent = `ë¹ˆì¹¸ 1~${quizRange}`;
        document.getElementById('r-time').textContent = `${sec}ì´ˆ`;
        document.getElementById('r-wrong').textContent = `${quizWrong}ë²ˆ`;
        speak(`ë‹¤ í’€ì—ˆì–´ìš”. ${nativeNum(quizCorrect)} ë¬¸ì œ ë§í˜”ì–´ìš”.`);
    }

    function scatterPositions(count, areaW, areaH, chipSize) {
        const gap = Math.round(chipSize * 0.3);
        const cell = chipSize + gap;
        const jitter = Math.round(gap * 0.4);
        const cols = Math.max(1, Math.floor(areaW / cell));
        const minRows = Math.ceil(count / cols);
        const totalRows = minRows + Math.max(1, Math.round(minRows * 0.15));
        const totalCells = totalRows * cols;

        // ì…€ ì¸ë±ìŠ¤ë¥¼ ì„ì–´ì„œ countê°œë§Œ ì„ íƒ â†’ ë¹ˆ ì…€ì´ ìƒê²¨ í©ë¿Œë¦° ëŠë‚Œ
        const indices = [];
        for (let i = 0; i < totalCells; i++) indices.push(i);
        shuffle(indices);
        const chosen = indices.slice(0, count);

        const offsetX = Math.max(0, (areaW - cols * cell) / 2);

        return chosen.map(idx => {
            const col = idx % cols;
            const row = Math.floor(idx / cols);
            return {
                x: offsetX + col * cell + Math.random() * jitter,
                y: row * cell + Math.random() * jitter
            };
        });
    }

    function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
    }

    // ê³ ìœ ì–´ ìˆ˜ì‚¬ (ë¬¸ì œ, ê°œ ë“± ë‹¨ìœ„ ì•ì— ì‚¬ìš©)
    function nativeNum(n) {
        const w = ['', 'í•œ', 'ë‘', 'ì„¸', 'ë„¤', 'ë‹¤ì„¯', 'ì—¬ì„¯', 'ì¼ê³±', 'ì—¬ëŸ', 'ì•„í™‰', 'ì—´'];
        return w[n] || String(n);
    }

    function speak(text) {
        if (!ttsEnabled || !window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ko-KR'; u.rate = 0.9;
        setTimeout(() => window.speechSynthesis.speak(u), 50);
    }

    // ì „ì—­ ì´ë²¤íŠ¸
    document.addEventListener('mousemove', e => moveHandler(e.clientX, e.clientY));
    document.addEventListener('mouseup', e => endHandler(e.clientX, e.clientY));
    document.addEventListener('touchmove', e => {
        if (dragging) { e.preventDefault(); const t = e.touches[0]; moveHandler(t.clientX, t.clientY); }
    }, { passive: false });
    document.addEventListener('touchend', e => {
        if (dragging) { const t = e.changedTouches[0]; endHandler(t.clientX, t.clientY); }
    });

    // TTS ì´ˆê¸°í™”
    if (window.speechSynthesis) {
        speechSynthesis.getVoices();
        if (speechSynthesis.onvoiceschanged !== undefined)
            speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    }
</script>

</body>
</html>
