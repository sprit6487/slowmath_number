<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ëŠë¦°ì•„ì´ ìˆ«ì</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        warm: {
                            50: '#FDFCFA', 100: '#FAF7F2', 200: '#F3EDE4',
                            300: '#E8DFD2', 400: '#B8AD9E', 500: '#8C8070',
                            600: '#6B5F50', 700: '#4A4035', 800: '#2E261D',
                        },
                        app: {
                            blue: '#6BADE8', green: '#5BC886', orange: '#F0A050', red: '#F07070',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;900&display=swap');

        *, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0; padding: 0;
            background: #F5F1EB;
            min-height: 100dvh;
            display: flex; justify-content: center; align-items: flex-start;
        }

        .app {
            width: 100%; max-width: 600px;
            min-height: 100dvh;
            background: white;
            padding: 24px 16px;
            padding-top: max(24px, env(safe-area-inset-top));
            padding-bottom: max(24px, env(safe-area-inset-bottom));
            display: flex; flex-direction: column;
        }

        /* íƒœë¸”ë¦¿ ë¯¸ë””ì–´ì¿¼ë¦¬: í•˜ë‹¨ í†µí•© */

        /* ëª¨ë“œ ì¹´ë“œ */
        .mode-card {
            transition: transform 0.12s, box-shadow 0.12s;
            cursor: pointer; user-select: none;
        }
        .mode-card:active { transform: scale(0.97); }
        .mode-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.06); }

        /* í™ˆ ë²„íŠ¼ */
        .btn-home {
            width: 36px; height: 36px; border-radius: 10px;
            border: 2px solid #E8E2DA; background: white;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: background 0.15s;
            font-size: 1rem; color: #8C8070;
        }
        .btn-home:active { background: #F5F1EB; }

        /* í”„ë¡œê·¸ë ˆìŠ¤ */
        .progress-track { height: 8px; border-radius: 99px; background: #F0ECE6; overflow: hidden; }
        .progress-bar {
            height: 100%; border-radius: 99px;
            background: linear-gradient(90deg, #6BADE8, #5BC886);
            transition: width 0.5s ease;
        }

        /* ìŠ¬ë¡¯ ê·¸ë¦¬ë“œ */
        .slots-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
            width: 100%;
        }

        /* ë¹ˆì¹¸ ìŠ¬ë¡¯ */
        .slot {
            aspect-ratio: 1;
            width: 100%;
            border: 2.5px dashed #D0C8BC;
            border-radius: 12px;
            background: #FDFCFA;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; font-weight: 800;
            color: #D0C8BC;
            transition: all 0.2s;
            position: relative;
        }
        .slot.drag-over {
            border-color: #6BADE8; border-style: solid;
            background: #EEF6FD;
            transform: scale(1.08);
        }
        .slot.filled {
            border: 2.5px solid #5BC886;
            background: #D4F5E0;
            color: #1A7A3A;
            cursor: default;
        }
        .slot.wrong {
            border-color: #F07070;
            background: #FDE8E8;
            animation: shake 0.4s ease;
        }

        /* í©ë¿Œë¦¬ê¸° ì˜ì—­ */
        .scatter-area {
            position: relative;
            width: 100%;
            min-height: 220px;
        }

        /* ë“œë˜ê·¸ ìˆ«ì */
        .num-chip {
            width: 50px; height: 50px;
            border-radius: 50%;
            border: 2.5px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.15rem; font-weight: 800;
            color: #4A4035;
            cursor: grab;
            touch-action: none;
            user-select: none;
            position: absolute;
            transition: transform 0.1s, box-shadow 0.1s, opacity 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .num-chip:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
        .num-chip:active { cursor: grabbing; }
        .num-chip.dragging {
            opacity: 0.3;
        }
        .num-chip.placed {
            opacity: 0; pointer-events: none;
            transform: scale(0.5);
        }

        /* í”Œë¡œíŒ… */
        .floating-num {
            position: fixed; z-index: 9999; pointer-events: none;
            width: 60px; height: 60px;
            border-radius: 16px;
            background: #4A4035;
            color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; font-weight: 900;
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.3s ease-out; }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.15); }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in { animation: pop 0.35s ease-out; }

        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ë¹ˆì¹¸ ë§ì¶”ê¸° ì¹´ë“œ */
        .quiz-card {
            width: 72px; height: 72px;
            border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: 900;
            user-select: none;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .quiz-cards-8 .quiz-card {
            width: 58px; height: 58px;
            font-size: 1.25rem;
            border-radius: 14px;
        }
        .quiz-card.open {
            border: 2.5px solid #6BADE8;
            background: #EEF6FD;
            color: #2E7FD9;
        }
        .quiz-card.hidden-card {
            border: 2.5px dashed #D0C8BC;
            background: #FDFCFA;
            color: #D0C8BC;
            font-size: 1.2rem;
        }
        .quiz-card.hidden-card.drag-over {
            border-color: #6BADE8; border-style: solid;
            background: #D9EDFC;
            transform: scale(1.08);
        }
        .quiz-card.hidden-card.filled {
            border: 2.5px solid #5BC886;
            background: #D4F5E0;
            color: #1A7A3A;
        }
        .quiz-card.hidden-card.wrong {
            border-color: #F07070;
            background: #FDE8E8;
            animation: shake 0.4s ease;
        }
        /* quiz-card íƒœë¸”ë¦¿: í•˜ë‹¨ í†µí•© */

        /* ë¹ˆì¹¸ ë§ì¶”ê¸° ì¹© */
        .quiz-chip {
            width: 56px; height: 56px;
            border-radius: 50%;
            border: 2.5px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; font-weight: 800;
            color: #4A4035;
            cursor: grab;
            touch-action: none;
            user-select: none;
            transition: transform 0.1s, box-shadow 0.1s, opacity 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .quiz-chip:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
        .quiz-chip:active { cursor: grabbing; }
        .quiz-chip.dragging { opacity: 0.3; }
        .quiz-chip.placed { opacity: 0; pointer-events: none; transform: scale(0.5); }

        /* ì†ê°€ë½ ê°œìˆ˜ ë§ì¶”ê¸° */
        .finger-display {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 210px;
            margin-bottom: 8px;
        }
        .hand-image {
            display: block;
            max-height: 200px;
            max-width: 260px;
            margin: 0 auto;
            object-fit: contain;
        }
        /* ì¶©ë™ë°©ì§€ í† ê¸€ */
        .impulse-toggle {
            display: flex; align-items: center; gap: 10px;
            padding: 12px 16px;
            border-radius: 16px;
            border: 2px solid #E8E2DA;
            background: white;
            transition: border-color 0.2s, background 0.2s;
        }
        .impulse-toggle.active { border-color: #6BADE8; background: #EEF6FD; }
        .toggle-switch {
            width: 44px; height: 24px;
            border-radius: 12px;
            background: #D0C8BC;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
            flex-shrink: 0;
        }
        .toggle-switch.on { background: #6BADE8; }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px; height: 20px;
            border-radius: 50%;
            background: white;
            top: 2px; left: 2px;
            transition: transform 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
        }
        .toggle-switch.on::after { transform: translateX(20px); }
        .impulse-details {
            overflow: hidden;
            max-height: 0; opacity: 0;
            transition: max-height 0.3s, opacity 0.3s, margin 0.3s;
            margin-top: 0;
        }
        .impulse-details.show { max-height: 200px; opacity: 1; margin-top: 10px; }
        .impulse-mode-options {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
            margin-bottom: 10px;
        }
        .impulse-mode-btn {
            display: flex; flex-direction: column; align-items: center;
            padding: 10px 8px;
            border-radius: 14px;
            border: 2px solid #E8E2DA;
            background: white;
            cursor: pointer;
            transition: all 0.15s;
        }
        .impulse-mode-btn.selected { border-color: #6BADE8; background: #EEF6FD; }
        .impulse-mode-icon { font-size: 1.2rem; margin-bottom: 2px; }
        .impulse-mode-label { font-size: 0.8rem; font-weight: 700; color: #4A4035; }
        .impulse-mode-desc { font-size: 0.65rem; color: #B8AD9E; margin-top: 1px; }
        .delay-options {
            display: flex; gap: 4px;
            flex-wrap: wrap; justify-content: center;
        }
        .delay-btn {
            min-width: 38px; height: 30px; padding: 0 6px;
            border-radius: 15px;
            border: 2px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.75rem; font-weight: 700;
            color: #6B5F50;
            cursor: pointer;
            transition: all 0.15s;
        }
        .delay-btn.selected { border-color: #6BADE8; background: #6BADE8; color: white; }
        /* ì¶©ë™ë°©ì§€: ë³´ê¸° ìˆ¨ê¹€ / ì„ íƒ ì ê¸ˆ */
        .chips-hidden { visibility: hidden; }
        .chips-locked { pointer-events: none; opacity: 0.45; }
        .delay-countdown {
            text-align: center;
            font-size: 1.5rem; font-weight: 900;
            color: #6BADE8;
            padding: 16px 0;
            animation: pulse-count 1s ease infinite;
        }
        @keyframes pulse-count {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.7; }
        }
        .finger-chip {
            width: 56px; height: 56px;
            border-radius: 50%;
            border: 2.5px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; font-weight: 800;
            color: #4A4035;
            cursor: pointer;
            user-select: none;
            transition: transform 0.15s, box-shadow 0.15s, opacity 0.2s, border-color 0.15s, background 0.15s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .finger-chip:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); transform: scale(1.05); }
        .finger-chip:active { transform: scale(0.95); }
        .finger-chip.correct-tap {
            border-color: #5BC886; background: #D4F5E0; color: #1A7A3A;
            pointer-events: none; transform: scale(1.1);
        }
        .finger-chip.wrong-tap {
            border-color: #F07070; background: #FDE8E8;
            animation: shake 0.4s ease;
        }
        .finger-chip.disabled { opacity: 0.4; pointer-events: none; }

        /* â”€â”€ ë°˜ì‘í˜•: ëª¨ë°”ì¼ (ê¸°ë³¸ê°’ ê°•í™”) â”€â”€ */
        @media (max-width: 374px) {
            .app { padding: 16px 10px; }
            .slot { border-radius: 8px; font-size: 0.9rem; }
            .num-chip { width: 42px; height: 42px; font-size: 1rem; }
            .quiz-card { width: 56px; height: 56px; font-size: 1.15rem; border-radius: 12px; }
            .quiz-cards-8 .quiz-card { width: 44px; height: 44px; font-size: 1rem; border-radius: 10px; }
            .quiz-chip { width: 48px; height: 48px; font-size: 1.05rem; }
            .finger-chip { width: 48px; height: 48px; font-size: 1.05rem; }
            .floating-num { width: 52px; height: 52px; font-size: 1.2rem; }
            .hand-image { max-height: 160px; max-width: 200px; }
            .finger-display { min-height: 170px; }
        }

        /* â”€â”€ ë°˜ì‘í˜•: íƒœë¸”ë¦¿ (768px+) â”€â”€ */
        @media (min-width: 768px) {
            body { align-items: center; padding: 32px; }
            .app {
                max-width: 720px; min-height: auto;
                border-radius: 32px;
                box-shadow: 0 8px 48px rgba(0,0,0,0.07), 0 1px 4px rgba(0,0,0,0.04);
                padding: 40px 36px;
            }
            .btn-home { width: 44px; height: 44px; border-radius: 12px; }
            .btn-home svg { width: 22px; height: 22px; }
            .progress-track { height: 10px; }
            .mode-card { padding: 20px !important; }
            .mode-card p:first-child { font-size: 1.4rem !important; }
            .mode-card p:last-child { font-size: 0.85rem !important; }
            .slots-grid { gap: 6px; }
            .slot { border-radius: 14px; font-size: 1.3rem; border-width: 3px; }
            .num-chip { width: 64px; height: 64px; font-size: 1.35rem; }
            .floating-num { width: 72px; height: 72px; font-size: 1.6rem; border-radius: 20px; }
            .quiz-card { width: 80px; height: 80px; font-size: 1.7rem; border-radius: 18px; }
            .quiz-cards-8 .quiz-card { width: 72px; height: 72px; font-size: 1.4rem; border-radius: 16px; }
            .quiz-chip { width: 68px; height: 68px; font-size: 1.4rem; }
            .finger-display { min-height: 300px; }
            .hand-image { max-height: 280px; max-width: 360px; }
            .finger-chip { width: 72px; height: 72px; font-size: 1.5rem; }
            #finger-chips { gap: 16px !important; }
            #quiz-chips { gap: 16px !important; }
            .impulse-toggle { padding: 16px 20px; border-radius: 20px; }
            .delay-btn { min-width: 44px; height: 36px; font-size: 0.85rem; }
            .delay-countdown { font-size: 1.8rem; }
        }

        /* â”€â”€ ë°˜ì‘í˜•: í° íƒœë¸”ë¦¿ (1024px+) â”€â”€ */
        @media (min-width: 1024px) {
            .app { max-width: 800px; padding: 48px 44px; }
            .mode-card p:first-child { font-size: 1.6rem !important; }
            .slot { font-size: 1.4rem; }
            .num-chip { width: 72px; height: 72px; font-size: 1.5rem; }
            .quiz-card { width: 90px; height: 90px; font-size: 1.9rem; }
            .quiz-cards-8 .quiz-card { width: 80px; height: 80px; font-size: 1.55rem; }
            .quiz-chip { width: 76px; height: 76px; font-size: 1.55rem; }
            .finger-display { min-height: 360px; }
            .hand-image { max-height: 340px; max-width: 420px; }
            .finger-chip { width: 84px; height: 84px; font-size: 1.7rem; }
        }
    </style>
</head>
<body>

<div class="app">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì‹œì‘ í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="start-view" class="flex flex-col flex-1">
        <div class="text-center pt-4 pb-6">
            <div class="inline-block mb-3">
                <svg viewBox="0 0 120 100" width="120" height="100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <ellipse cx="30" cy="72" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(-20 30 72)"/>
                    <ellipse cx="78" cy="76" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(15 78 76)"/>
                    <ellipse cx="28" cy="54" rx="9" ry="5.5" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(-10 28 54)"/>
                    <path d="M18 60 L10 55" stroke="#F2DC8C" stroke-width="4" stroke-linecap="round"/>
                    <ellipse cx="55" cy="58" rx="35" ry="20" fill="#F5E6C8" stroke="#3A9B6A" stroke-width="2"/>
                    <ellipse cx="52" cy="42" rx="32" ry="28" fill="#7EDCAA" stroke="#3A9B6A" stroke-width="2.5"/>
                    <path d="M52 18 L42 32 L42 48 L52 58 L62 48 L62 32 Z" fill="none" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="42" y1="32" x2="24" y2="38" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="62" y1="32" x2="80" y2="38" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="42" y1="48" x2="26" y2="56" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="62" y1="48" x2="78" y2="56" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <ellipse cx="42" cy="26" rx="6" ry="4" fill="white" opacity="0.35" transform="rotate(-15 42 26)"/>
                    <ellipse cx="62" cy="36" rx="4" ry="3" fill="white" opacity="0.2"/>
                    <ellipse cx="92" cy="40" rx="17" ry="15" fill="#F5E6C8" stroke="#3A9B6A" stroke-width="2.5"/>
                    <ellipse cx="82" cy="72" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(10 82 72)"/>
                    <circle cx="99" cy="35" r="4" fill="white" stroke="#3A9B6A" stroke-width="1.5"/>
                    <circle cx="100" cy="34" r="2.5" fill="#3A9B6A"/>
                    <circle cx="101" cy="33" r="1" fill="white"/>
                    <circle cx="100" cy="44" r="3.5" fill="#F0A050" opacity="0.4"/>
                    <path d="M94 46 Q98 50 103 46" fill="none" stroke="#3A9B6A" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            <h1 class="text-3xl font-black tracking-tight">
                <span style="color:#2E7FD9;">ëŠë¦°</span><span style="color:#F0901E;">ì•„ì´</span> <span style="color:#4A4035;">ìˆ«ì</span>
            </h1>
            <p class="text-sm mt-2" style="color:#B8AD9E;">ìˆ«ìë¥¼ ì°¨ë¡€ëŒ€ë¡œ ë†“ì•„ë´ìš”</p>
        </div>

        <div class="flex flex-col gap-4 flex-1">
            <div>
                <div class="flex items-center gap-2 mb-2 px-1">
                    <span class="text-base">ğŸ”¢</span>
                    <span class="text-sm font-semibold" style="color:#6B5F50;">ìˆ«ì ìˆœì„œ ë§ì¶”ê¸°</span>
                    <span class="text-xs" style="color:#B8AD9E;">ë“œë˜ê·¸ë¡œ ë¹ˆì¹¸ ì±„ìš°ê¸°</span>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="startGame(10)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 10</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">í•œ ì¤„ ì±„ìš°ê¸°</p>
                    </button>
                    <button onclick="startGame(20)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 20</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ë‘ ì¤„ ì±„ìš°ê¸°</p>
                    </button>
                    <button onclick="startGame(30)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 30</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ì„¸ ì¤„ ì±„ìš°ê¸°</p>
                    </button>
                    <button onclick="startGame(50)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 50</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ë‹¤ì„¯ ì¤„ ì±„ìš°ê¸°</p>
                    </button>
                </div>
            </div>

            <!-- ë¹ˆì¹¸ ë§ì¶”ê¸° ëª¨ë“œ -->
            <div>
                <div class="flex items-center gap-2 mb-2 px-1">
                    <span class="text-base">ğŸƒ</span>
                    <span class="text-sm font-semibold" style="color:#6B5F50;">ë¹ˆì¹¸ ë§ì¶”ê¸°</span>
                    <span class="text-xs" style="color:#B8AD9E;">ìˆ¨ì€ ìˆ«ìë¥¼ ì°¾ì•„ìš”</span>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="startQuiz(10)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 10</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ì—°ì† 8ê°œ ì¤‘ 4ê°œ ìˆ¨ê¹€</p>
                    </button>
                    <button onclick="startQuiz(20)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 20</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ì—°ì† 8ê°œ ì¤‘ 4ê°œ ìˆ¨ê¹€</p>
                    </button>
                    <button onclick="startQuiz(30)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 30</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ì—°ì† 8ê°œ ì¤‘ 4ê°œ ìˆ¨ê¹€</p>
                    </button>
                    <button onclick="startQuiz(50)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 50</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ì—°ì† 8ê°œ ì¤‘ 4ê°œ ìˆ¨ê¹€</p>
                    </button>
                </div>
            </div>

            <!-- ì†ê°€ë½ ê°œìˆ˜ ë§ì¶”ê¸° ëª¨ë“œ -->
            <div>
                <div class="flex items-center gap-2 mb-2 px-1">
                    <span class="text-base">âœ‹</span>
                    <span class="text-sm font-semibold" style="color:#6B5F50;">ì†ê°€ë½ ê°œìˆ˜ ë§ì¶”ê¸°</span>
                    <span class="text-xs" style="color:#B8AD9E;">ì†ê°€ë½ì„ ì„¸ì–´ë´ìš”</span>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="startFinger(5)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 5</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">í•œ ì† ì„¸ê¸°</p>
                    </button>
                    <button onclick="startFinger(10)"
                            class="mode-card rounded-2xl p-4 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-lg font-bold" style="color:#4A4035;">1 ~ 10</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ë‘ ì† ì„¸ê¸°</p>
                    </button>
                </div>
            </div>
        </div>

        <!-- ì¶©ë™ë°©ì§€ ì„¤ì • -->
        <div style="margin-top: auto; padding-top: 12px;">
            <div class="impulse-toggle" id="impulse-toggle" onclick="toggleImpulse()">
                <div class="toggle-switch" id="impulse-switch"></div>
                <div>
                    <p class="text-sm font-semibold" style="color:#4A4035;">ì¶©ë™ë°©ì§€</p>
                    <p class="text-xs" style="color:#B8AD9E;">ìƒê°í•  ì‹œê°„ì„ ì¤˜ìš”</p>
                </div>
            </div>
            <div class="impulse-details" id="impulse-details">
                <div class="impulse-mode-options">
                    <button class="impulse-mode-btn selected" onclick="setImpulseMode('hide')" data-mode="hide">
                        <span class="impulse-mode-icon">ğŸ™ˆ</span>
                        <span class="impulse-mode-label">ë³´ê¸° ìˆ¨ê¸°ê¸°</span>
                        <span class="impulse-mode-desc">Nì´ˆ í›„ ë³´ê¸°ê°€ ë‚˜íƒ€ë‚˜ìš”</span>
                    </button>
                    <button class="impulse-mode-btn" onclick="setImpulseMode('lock')" data-mode="lock">
                        <span class="impulse-mode-icon">ğŸ”’</span>
                        <span class="impulse-mode-label">ì„ íƒ ì ê¸ˆ</span>
                        <span class="impulse-mode-desc">Nì´ˆ ë™ì•ˆ ì„ íƒí•  ìˆ˜ ì—†ì–´ìš”</span>
                    </button>
                </div>
                <div class="delay-options show">
                    <button class="delay-btn" onclick="setDelay(1)" data-delay="1">1ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(2)" data-delay="2">2ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(3)" data-delay="3">3ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(4)" data-delay="4">4ì´ˆ</button>
                    <button class="delay-btn selected" onclick="setDelay(5)" data-delay="5">5ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(6)" data-delay="6">6ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(7)" data-delay="7">7ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(8)" data-delay="8">8ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(9)" data-delay="9">9ì´ˆ</button>
                    <button class="delay-btn" onclick="setDelay(10)" data-delay="10">10ì´ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ê²Œì„ í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="game-view" class="hidden flex flex-col flex-1 fade-in">
        <!-- ìƒë‹¨ ë°” -->
        <div class="flex items-center gap-3 mb-4">
            <button onclick="goHome()" class="btn-home" title="í™ˆ">
                <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-8 9 8M5 11v9a1 1 0 001 1h3m8 0h3a1 1 0 001-1v-9"/></svg>
            </button>
            <div class="flex-1">
                <div class="flex justify-between items-center mb-1">
                    <span id="game-label" class="text-xs font-medium" style="color:#B8AD9E;">1 ~ 10</span>
                    <span id="placed-label" class="text-xs font-medium" style="color:#B8AD9E;">0 / 10</span>
                </div>
                <div class="progress-track">
                    <div id="progress" class="progress-bar" style="width:0%"></div>
                </div>
            </div>
        </div>

        <!-- ì•ˆë‚´ -->
        <p id="hint-text" class="text-center text-sm mb-4 font-medium" style="color:#6BADE8;">
            ìˆ«ìë¥¼ ìˆœì„œëŒ€ë¡œ ë¹ˆì¹¸ì— ë†“ì•„ë´ìš”
        </p>

        <!-- ìŠ¬ë¡¯ ì˜ì—­ (10ì¹¸ í•œ ì¤„) -->
        <div id="slots" class="slots-grid mb-5"></div>

        <!-- êµ¬ë¶„ì„  -->
        <div class="mb-2" style="border-top:1.5px solid #F0ECE6;"></div>

        <!-- ìˆ«ì ì¹© ì˜ì—­ (í©ë¿Œë¦¬ê¸°) -->
        <p class="text-center text-xs mb-2 mt-2" style="color:#D0C8BC;">ì•„ë˜ ìˆ«ìë¥¼ ìœ„ ë¹ˆì¹¸ìœ¼ë¡œ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</p>
        <div id="chips" class="scatter-area"></div>

        <!-- í”¼ë“œë°± -->
        <div id="feedback" class="text-center h-8 text-base font-bold mt-4" style="color:#4A4035;"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë¹ˆì¹¸ ë§ì¶”ê¸° í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="quiz-view" class="hidden flex flex-col flex-1 fade-in">
        <div class="flex items-center gap-3 mb-4">
            <button onclick="goHome()" class="btn-home" title="í™ˆ">
                <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-8 9 8M5 11v9a1 1 0 001 1h3m8 0h3a1 1 0 001-1v-9"/></svg>
            </button>
            <div class="flex-1">
                <div class="flex justify-between items-center mb-1">
                    <span id="quiz-label" class="text-xs font-medium" style="color:#B8AD9E;">ë¬¸ì œ 1 / 5</span>
                    <span class="text-xs font-medium" style="color:#B8AD9E;">ë§íŒ ë¬¸ì œ: <span id="quiz-score" style="color:#5BC886;">0</span></span>
                </div>
                <div class="progress-track">
                    <div id="quiz-progress" class="progress-bar" style="width:0%"></div>
                </div>
            </div>
        </div>

        <p id="quiz-hint" class="text-center text-sm mb-5 font-medium" style="color:#6BADE8;">
            ìˆ¨ì€ ìˆ«ìë¥¼ ì°¾ì•„ì„œ ë¹ˆì¹¸ì— ë†“ì•„ë´ìš”
        </p>

        <!-- ì¹´ë“œ ì¤„ -->
        <div id="quiz-cards" class="flex justify-center gap-2 mb-8"></div>

        <!-- êµ¬ë¶„ì„  -->
        <div class="mb-4" style="border-top:1.5px solid #F0ECE6;"></div>

        <!-- ì„ íƒì§€ ì¹© -->
        <p class="text-center text-xs mb-3" style="color:#D0C8BC;">ìˆ¨ì€ ìˆ«ìë¥¼ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</p>
        <div id="quiz-chips" class="flex justify-center gap-3 flex-wrap"></div>

        <div id="quiz-feedback" class="text-center h-8 text-base font-bold mt-6" style="color:#4A4035;"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì†ê°€ë½ ë§ì¶”ê¸° í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="finger-view" class="hidden flex flex-col flex-1 fade-in">
        <div class="flex items-center gap-3 mb-4">
            <button onclick="goHome()" class="btn-home" title="í™ˆ">
                <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-8 9 8M5 11v9a1 1 0 001 1h3m8 0h3a1 1 0 001-1v-9"/></svg>
            </button>
            <div class="flex-1">
                <div class="flex justify-between items-center mb-1">
                    <span id="finger-label" class="text-xs font-medium" style="color:#B8AD9E;">ë¬¸ì œ 1 / 5</span>
                    <span class="text-xs font-medium" style="color:#B8AD9E;">ë§íŒ ë¬¸ì œ: <span id="finger-score" style="color:#5BC886;">0</span></span>
                </div>
                <div class="progress-track">
                    <div id="finger-progress" class="progress-bar" style="width:0%"></div>
                </div>
            </div>
        </div>

        <p id="finger-hint" class="text-center text-sm mb-3 font-medium" style="color:#6BADE8;">
            ì†ê°€ë½ì´ ëª‡ ê°œì¼ê¹Œìš”?
        </p>

        <!-- ì†ê°€ë½ í‘œì‹œ ì˜ì—­ -->
        <div id="finger-display" class="finger-display"></div>

        <!-- êµ¬ë¶„ì„  -->
        <div class="mb-3" style="border-top:1.5px solid #F0ECE6;"></div>

        <!-- ì„ íƒì§€ ì¹© -->
        <p class="text-center text-xs mb-3" style="color:#D0C8BC;">ì•Œë§ì€ ìˆ«ìë¥¼ ê³¨ë¼ë³´ì„¸ìš”</p>
        <div id="finger-chips" class="flex justify-center gap-3 flex-wrap"></div>

        <div id="finger-feedback" class="text-center h-8 text-base font-bold mt-4" style="color:#4A4035;"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ê²°ê³¼ í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="result-view" class="hidden flex flex-col flex-1 fade-in">
        <div class="flex-1 flex flex-col justify-center">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ†</div>
                <h2 class="text-2xl font-bold" style="color:#4A4035;">ë‹¤ ë§í˜”ì–´ìš”!</h2>
                <p class="text-sm mt-2" style="color:#B8AD9E;">ìˆ«ì ìˆœì„œë¥¼ ì˜ ì•Œê³  ìˆì–´ìš”</p>
            </div>
            <div class="flex flex-col gap-3 mb-8">
                <div class="flex justify-between items-center rounded-2xl p-4" style="background:#F5FAFF; border:1.5px solid #D9EDFC;">
                    <span class="text-sm" style="color:#6B5F50;">ë²”ìœ„</span>
                    <span id="r-range" class="text-lg font-bold" style="color:#4A8FC2;">1 ~ 10</span>
                </div>
                <div class="flex justify-between items-center rounded-2xl p-4" style="background:#FFFAF2; border:1.5px solid #F5D5A8;">
                    <span class="text-sm" style="color:#6B5F50;">ê±¸ë¦° ì‹œê°„</span>
                    <span id="r-time" class="text-lg font-bold" style="color:#C07830;">0ì´ˆ</span>
                </div>
                <div class="flex justify-between items-center rounded-2xl p-4" style="background:#FDE8E8; border:1.5px solid #F5B8B8;">
                    <span class="text-sm" style="color:#6B5F50;">í‹€ë¦° íšŸìˆ˜</span>
                    <span id="r-wrong" class="text-lg font-bold" style="color:#D04040;">0ë²ˆ</span>
                </div>
            </div>
        </div>
        <button onclick="goHome()"
                class="w-full py-4 rounded-2xl font-bold text-lg border-2 transition hover:opacity-90 active:scale-[0.98]"
                style="border-color:#E8E2DA; color:#6B5F50; background:white;">
            ë‹¤ì‹œ í•˜ê¸°
        </button>
    </div>
</div>

<script>
    let maxNum = 10;
    let nextExpected = 1;
    let placedCount = 0;
    let wrongCount = 0;
    let startTime = 0;

    // ë“œë˜ê·¸ ìƒíƒœ
    let dragging = false;
    let dragValue = null;
    let dragChipEl = null;
    let floatingEl = null;

    // ì¶©ë™ë°©ì§€
    let impulseEnabled = false;
    let impulseDelay = 5;
    let impulseMode = 'hide'; // 'hide' = ë³´ê¸° ìˆ¨ê¸°ê¸°, 'lock' = ì„ íƒ ì ê¸ˆ
    let impulseTimer = null;

    function toggleImpulse() {
        impulseEnabled = !impulseEnabled;
        document.getElementById('impulse-switch').classList.toggle('on', impulseEnabled);
        document.getElementById('impulse-toggle').classList.toggle('active', impulseEnabled);
        document.getElementById('impulse-details').classList.toggle('show', impulseEnabled);
    }

    function setImpulseMode(mode) {
        impulseMode = mode;
        document.querySelectorAll('.impulse-mode-btn').forEach(b => {
            b.classList.toggle('selected', b.dataset.mode === mode);
        });
    }

    function setDelay(sec) {
        impulseDelay = sec;
        document.querySelectorAll('.delay-btn').forEach(b => {
            b.classList.toggle('selected', parseInt(b.dataset.delay) === sec);
        });
    }

    function applyImpulseDelay(chipsEl, countdownParent) {
        if (!impulseEnabled) return;

        const isHide = impulseMode === 'hide';
        chipsEl.classList.add(isHide ? 'chips-hidden' : 'chips-locked');

        // ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ
        const cdEl = document.createElement('div');
        cdEl.className = 'delay-countdown';
        cdEl.id = 'impulse-countdown';
        countdownParent.insertBefore(cdEl, chipsEl);

        let remaining = impulseDelay;
        cdEl.textContent = isHide
            ? `${remaining}ì´ˆ í›„ ë³´ê¸°ê°€ ë‚˜ì™€ìš”`
            : `${remaining}ì´ˆ ë™ì•ˆ ìƒê°í•´ ë³´ì„¸ìš”`;

        impulseTimer = setInterval(() => {
            remaining--;
            if (remaining <= 0) {
                clearInterval(impulseTimer);
                impulseTimer = null;
                cdEl.remove();
                chipsEl.classList.remove('chips-hidden', 'chips-locked');
            } else {
                cdEl.textContent = isHide
                    ? `${remaining}ì´ˆ í›„ ë³´ê¸°ê°€ ë‚˜ì™€ìš”`
                    : `${remaining}ì´ˆ ë™ì•ˆ ìƒê°í•´ ë³´ì„¸ìš”`;
            }
        }, 1000);
    }

    function clearImpulseTimer() {
        if (impulseTimer) { clearInterval(impulseTimer); impulseTimer = null; }
        const cd = document.getElementById('impulse-countdown');
        if (cd) cd.remove();
        // ì”ì—¬ í´ë˜ìŠ¤ ì •ë¦¬
        document.querySelectorAll('.chips-hidden, .chips-locked').forEach(el => {
            el.classList.remove('chips-hidden', 'chips-locked');
        });
    }

    function startGame(range) {
        maxNum = range;
        nextExpected = 1;
        placedCount = 0;
        wrongCount = 0;
        startTime = Date.now();

        document.getElementById('start-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('game-view').classList.remove('hidden');

        document.getElementById('game-label').textContent = `1 ~ ${maxNum}`;
        document.getElementById('feedback').textContent = '';
        updateProgress();

        // ìŠ¬ë¡¯ ìƒì„± (10ì¹¸ í•œ ì¤„, 20ì´ë©´ ë‘ ì¤„)
        const slotsEl = document.getElementById('slots');
        slotsEl.innerHTML = '';
        for (let i = 1; i <= maxNum; i++) {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.num = i;
            const hint = document.createElement('span');
            hint.textContent = i;
            hint.style.opacity = '0.3';
            hint.style.fontSize = '0.8rem';
            slot.appendChild(hint);
            slotsEl.appendChild(slot);
        }

        // ì¹© ìƒì„± (ëœë¤ ìœ„ì¹˜ì— í©ë¿Œë¦¬ê¸°)
        const nums = [];
        for (let i = 1; i <= maxNum; i++) nums.push(i);
        shuffle(nums);

        const chipsEl = document.getElementById('chips');
        chipsEl.innerHTML = '';
        // í©ë¿Œë¦¬ê¸° ì˜ì—­ ë†’ì´ ì¡°ì • (íƒœë¸”ë¦¿ì€ ë” ë„“ê²Œ)
        const isTablet = window.innerWidth >= 768;
        const chipPx = isTablet ? 68 : 54;
        const scatterBase = maxNum <= 10 ? 200 : maxNum <= 20 ? 280 : maxNum <= 30 ? 360 : 480;
        const scatterH = isTablet ? Math.round(scatterBase * 1.2) : scatterBase;
        chipsEl.style.minHeight = scatterH + 'px';

        // ê²¹ì¹¨ ë°©ì§€ë¥¼ ìœ„í•œ ìœ„ì¹˜ ê³„ì‚°
        const positions = scatterPositions(nums.length, chipsEl.offsetWidth || 500, scatterH, chipPx);

        nums.forEach((n, idx) => {
            const chip = document.createElement('div');
            chip.className = 'num-chip';
            chip.textContent = n;
            chip.dataset.num = n;
            chip.style.left = positions[idx].x + 'px';
            chip.style.top = positions[idx].y + 'px';
            bindDrag(chip, n);
            chipsEl.appendChild(chip);
        });

        updateHint();

        // TTS ì´ˆê¸°í™”
        if (window.speechSynthesis) speechSynthesis.speak(new SpeechSynthesisUtterance(''));
        setTimeout(() => speak('ì²œì²œíˆ ìƒê°í•˜ê³  í’€ì–´ë³´ì„¸ìš”.'), 100);

        // ì¶©ë™ë°©ì§€
        applyImpulseDelay(chipsEl, chipsEl.parentElement);
    }

    function bindDrag(chip, value) {
        chip.addEventListener('mousedown', e => {
            e.preventDefault();
            beginDrag(chip, value, e.clientX, e.clientY);
        });
        chip.addEventListener('touchstart', e => {
            e.preventDefault();
            const t = e.touches[0];
            beginDrag(chip, value, t.clientX, t.clientY);
        }, { passive: false });
    }

    function beginDrag(chip, value, x, y) {
        if (dragging) return;
        dragging = true;
        dragValue = value;
        dragChipEl = chip;
        chip.classList.add('dragging');

        floatingEl = document.createElement('div');
        floatingEl.className = 'floating-num';
        floatingEl.textContent = value;
        floatingEl.style.left = x + 'px';
        floatingEl.style.top = y + 'px';
        document.body.appendChild(floatingEl);

        highlightTarget(x, y);
    }

    function isQuizMode() {
        return !document.getElementById('quiz-view').classList.contains('hidden');
    }

    function moveHandler(x, y) {
        if (!dragging || !floatingEl) return;
        floatingEl.style.left = x + 'px';
        floatingEl.style.top = y + 'px';
        if (isQuizMode()) highlightQuizTarget(x, y);
        else highlightTarget(x, y);
    }

    function endHandler(x, y) {
        if (!dragging) return;

        if (isQuizMode()) {
            endQuizDrag(x, y);
            return;
        }

        // ì–´ë–¤ ìŠ¬ë¡¯ ìœ„ì¸ì§€ í™•ì¸
        const target = getSlotAt(x, y);
        clearHighlights();

        if (target && !target.classList.contains('filled')) {
            const slotNum = parseInt(target.dataset.num);
            if (dragValue === slotNum && dragValue === nextExpected) {
                // ì •ë‹µ
                placeNumber(target, dragValue);
            } else {
                // ì˜¤ë‹µ
                wrongCount++;
                target.classList.add('wrong');
                setTimeout(() => target.classList.remove('wrong'), 400);
                const fb = document.getElementById('feedback');
                if (dragValue !== nextExpected) {
                    fb.textContent = `${nextExpected}ì„ ë¨¼ì € ë†“ì•„ì•¼ í•´ìš”`;
                } else {
                    fb.textContent = 'ì´ ì¹¸ì€ ë‹¤ë¥¸ ìˆ«ì ìë¦¬ì˜ˆìš”';
                }
                fb.style.color = '#F07070';
                speak('ë‹¤ì‹œ í•´ë´ìš”.');
            }
        }

        // ì •ë¦¬
        if (floatingEl) { floatingEl.remove(); floatingEl = null; }
        if (dragChipEl) dragChipEl.classList.remove('dragging');
        dragging = false;
        dragValue = null;
        dragChipEl = null;
    }

    function placeNumber(slot, value) {
        slot.innerHTML = '';
        slot.textContent = value;
        slot.classList.add('filled', 'pop-in');
        slot.style.fontSize = '1.25rem';

        // ì¹© ìˆ¨ê¸°ê¸°
        dragChipEl.classList.add('placed');

        placedCount++;
        nextExpected++;
        updateProgress();
        updateHint();

        const fb = document.getElementById('feedback');

        if (placedCount >= maxNum) {
            fb.textContent = 'ì™„ì„±! ğŸ‰';
            fb.style.color = '#5BC886';
            speak('ë‹¤ ë§í˜”ì–´ìš”! ì •ë§ ì˜í–ˆì–´ìš”.');
            setTimeout(showResult, 1500);
        } else {
            fb.textContent = 'ì˜í–ˆì–´ìš”!';
            fb.style.color = '#5BC886';
            speak(String(value));
            setTimeout(() => {
                if (fb.textContent === 'ì˜í–ˆì–´ìš”!') {
                    fb.textContent = '';
                }
            }, 800);
        }
    }

    function highlightTarget(x, y) {
        clearHighlights();
        const target = getSlotAt(x, y);
        if (target && !target.classList.contains('filled')) {
            target.classList.add('drag-over');
        }
    }

    function clearHighlights() {
        document.querySelectorAll('.slot.drag-over').forEach(s => s.classList.remove('drag-over'));
    }

    function getSlotAt(x, y) {
        const slots = document.querySelectorAll('.slot');
        for (const slot of slots) {
            const r = slot.getBoundingClientRect();
            if (x >= r.left && x <= r.right && y >= r.top && y <= r.bottom) {
                return slot;
            }
        }
        return null;
    }

    function updateProgress() {
        document.getElementById('placed-label').textContent = `${placedCount} / ${maxNum}`;
        document.getElementById('progress').style.width = `${(placedCount / maxNum) * 100}%`;
    }

    function updateHint() {
        const hint = document.getElementById('hint-text');
        if (placedCount >= maxNum) {
            hint.textContent = 'ì™„ì„±!';
            hint.style.color = '#5BC886';
        } else {
            hint.textContent = `ë‹¤ìŒ ìˆ«ì: ${nextExpected}`;
            hint.style.color = '#6BADE8';
        }
    }

    function showResult() {
        const sec = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById('game-view').classList.add('hidden');
        document.getElementById('result-view').classList.remove('hidden');
        document.getElementById('r-range').textContent = `1 ~ ${maxNum}`;
        document.getElementById('r-time').textContent = `${sec}ì´ˆ`;
        document.getElementById('r-wrong').textContent = `${wrongCount}ë²ˆ`;
    }

    function goHome() {
        clearImpulseTimer();
        if (floatingEl) { floatingEl.remove(); floatingEl = null; }
        dragging = false;
        document.getElementById('game-view').classList.add('hidden');
        document.getElementById('quiz-view').classList.add('hidden');
        document.getElementById('finger-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('start-view').classList.remove('hidden');
    }

    // â”€â”€ ë¹ˆì¹¸ ë§ì¶”ê¸° ëª¨ë“œ â”€â”€
    const QUIZ_TOTAL = 5;
    let quizRound = 0;
    let quizCorrect = 0;
    let quizWrong = 0;
    let quizStartTime = 0;
    let quizNumbers = [];      // ì •ë ¬ëœ 6ê°œ ìˆ«ì
    let quizHiddenSet = null;  // ìˆ¨ê¸´ 3ê°œ Set
    let quizNextHidden = null; // ì™¼ìª½ë¶€í„° ë§ì¶œ ë‹¤ìŒ ìˆ¨ê¸´ ìˆ«ì
    let quizHiddenOrder = [];  // ìˆ¨ê¸´ ìˆ«ì ì™¼â†’ì˜¤ ìˆœì„œ
    let quizPlacedInRound = 0;
    let quizFirstTryInRound = true;
    let quizRange = 10;

    function startQuiz(range) {
        quizRange = range;
        quizRound = 0;
        quizCorrect = 0;
        quizWrong = 0;
        quizStartTime = Date.now();

        document.getElementById('start-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('quiz-view').classList.remove('hidden');

        if (window.speechSynthesis) speechSynthesis.speak(new SpeechSynthesisUtterance(''));
        nextQuizRound();
    }

    function nextQuizRound() {
        quizRound++;
        quizPlacedInRound = 0;
        quizFirstTryInRound = true;

        document.getElementById('quiz-label').textContent = `ë¬¸ì œ ${quizRound} / ${QUIZ_TOTAL}`;
        document.getElementById('quiz-progress').style.width = `${(quizRound - 1) / QUIZ_TOTAL * 100}%`;
        document.getElementById('quiz-score').textContent = quizCorrect;
        document.getElementById('quiz-feedback').textContent = '';
        document.getElementById('quiz-hint').textContent = 'ìˆ¨ì€ ìˆ«ìë¥¼ ì°¾ì•„ì„œ ë¹ˆì¹¸ì— ë†“ì•„ë´ìš”';
        document.getElementById('quiz-hint').style.color = '#6BADE8';

        const cardCount = 8;
        const hideCount = 4;

        const maxStart = quizRange - cardCount + 1;
        const start = Math.floor(Math.random() * maxStart) + 1;
        quizNumbers = [];
        for (let i = start; i < start + cardCount; i++) quizNumbers.push(i);

        // ìˆ¨ê¸°ê¸°
        const indices = [];
        for (let i = 0; i < cardCount; i++) indices.push(i);
        shuffle(indices);
        const hiddenIndices = new Set(indices.slice(0, hideCount));
        quizHiddenSet = new Set();
        quizHiddenOrder = [];
        quizNumbers.forEach((n, i) => {
            if (hiddenIndices.has(i)) {
                quizHiddenSet.add(n);
                quizHiddenOrder.push(n);
            }
        });
        quizNextHidden = quizHiddenOrder[0];

        // ì¹´ë“œ ë Œë”ë§
        const cardsEl = document.getElementById('quiz-cards');
        cardsEl.innerHTML = '';
        cardsEl.classList.add('quiz-cards-8');
        quizNumbers.forEach((n, i) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            if (hiddenIndices.has(i)) {
                card.classList.add('hidden-card');
                card.textContent = '?';
                card.dataset.num = n;
            } else {
                card.classList.add('open');
                card.textContent = n;
            }
            cardsEl.appendChild(card);
        });

        // ì¹© ë Œë”ë§ (ìˆ¨ê¸´ 3ê°œë¥¼ ëœë¤ ìˆœì„œë¡œ)
        const hiddenNums = [...quizHiddenSet];
        shuffle(hiddenNums);
        const chipsEl = document.getElementById('quiz-chips');
        chipsEl.innerHTML = '';
        hiddenNums.forEach(n => {
            const chip = document.createElement('div');
            chip.className = 'quiz-chip';
            chip.textContent = n;
            chip.dataset.num = n;
            bindQuizDrag(chip, n);
            chipsEl.appendChild(chip);
        });

        // ì¶©ë™ë°©ì§€
        clearImpulseTimer();
        applyImpulseDelay(chipsEl, chipsEl.parentElement);
    }

    function bindQuizDrag(chip, value) {
        chip.addEventListener('mousedown', e => {
            e.preventDefault();
            beginQuizDrag(chip, value, e.clientX, e.clientY);
        });
        chip.addEventListener('touchstart', e => {
            e.preventDefault();
            const t = e.touches[0];
            beginQuizDrag(chip, value, t.clientX, t.clientY);
        }, { passive: false });
    }

    function beginQuizDrag(chip, value, x, y) {
        if (dragging) return;
        dragging = true;
        dragValue = value;
        dragChipEl = chip;
        chip.classList.add('dragging');

        floatingEl = document.createElement('div');
        floatingEl.className = 'floating-num';
        floatingEl.textContent = value;
        floatingEl.style.left = x + 'px';
        floatingEl.style.top = y + 'px';
        document.body.appendChild(floatingEl);

        highlightQuizTarget(x, y);
    }

    function highlightQuizTarget(x, y) {
        document.querySelectorAll('.quiz-card.hidden-card.drag-over').forEach(c => c.classList.remove('drag-over'));
        const target = getQuizCardAt(x, y);
        if (target && !target.classList.contains('filled')) {
            target.classList.add('drag-over');
        }
    }

    function getQuizCardAt(x, y) {
        const cards = document.querySelectorAll('.quiz-card.hidden-card');
        for (const card of cards) {
            const r = card.getBoundingClientRect();
            if (x >= r.left && x <= r.right && y >= r.top && y <= r.bottom) {
                return card;
            }
        }
        return null;
    }

    function endQuizDrag(x, y) {
        document.querySelectorAll('.quiz-card.hidden-card.drag-over').forEach(c => c.classList.remove('drag-over'));

        const target = getQuizCardAt(x, y);
        if (target && !target.classList.contains('filled')) {
            const cardNum = parseInt(target.dataset.num);
            if (dragValue === cardNum) {
                // ì •ë‹µ
                target.textContent = cardNum;
                target.classList.add('filled', 'pop-in');
                dragChipEl.classList.add('placed');
                quizPlacedInRound++;

                const fb = document.getElementById('quiz-feedback');

                if (quizPlacedInRound >= 4) {
                    // ì´ ë¼ìš´ë“œ ì™„ì„±
                    if (quizFirstTryInRound) quizCorrect++;
                    document.getElementById('quiz-score').textContent = quizCorrect;
                    document.getElementById('quiz-progress').style.width = `${quizRound / QUIZ_TOTAL * 100}%`;
                    fb.textContent = 'ì •ë‹µì´ì—ìš”! ğŸ‰';
                    fb.style.color = '#5BC886';
                    speak('ì •ë‹µì´ì—ìš”.');

                    if (quizRound >= QUIZ_TOTAL) {
                        setTimeout(showQuizResult, 1500);
                    } else {
                        setTimeout(nextQuizRound, 1300);
                    }
                } else {
                    fb.textContent = 'ì˜í–ˆì–´ìš”!';
                    fb.style.color = '#5BC886';
                    speak(String(cardNum));
                    setTimeout(() => { if (fb.textContent === 'ì˜í–ˆì–´ìš”!') fb.textContent = ''; }, 800);
                }
            } else {
                // ì˜¤ë‹µ
                quizWrong++;
                quizFirstTryInRound = false;
                target.classList.add('wrong');
                setTimeout(() => target.classList.remove('wrong'), 400);
                const fb = document.getElementById('quiz-feedback');
                fb.textContent = 'ì´ ì¹¸ì€ ë‹¤ë¥¸ ìˆ«ì ìë¦¬ì˜ˆìš”';
                fb.style.color = '#F07070';
                speak('ë‹¤ì‹œ í•´ë´ìš”.');
            }
        }

        // ì •ë¦¬
        if (floatingEl) { floatingEl.remove(); floatingEl = null; }
        if (dragChipEl) dragChipEl.classList.remove('dragging');
        dragging = false;
        dragValue = null;
        dragChipEl = null;
    }

    function showQuizResult() {
        const sec = Math.floor((Date.now() - quizStartTime) / 1000);
        document.getElementById('quiz-view').classList.add('hidden');
        document.getElementById('result-view').classList.remove('hidden');
        document.getElementById('r-range').textContent = `ë¹ˆì¹¸ 1~${quizRange}`;
        document.getElementById('r-time').textContent = `${sec}ì´ˆ`;
        document.getElementById('r-wrong').textContent = `${quizWrong}ë²ˆ`;
        speak(`ë‹¤ í’€ì—ˆì–´ìš”. ${nativeNum(quizCorrect)} ë¬¸ì œ ë§í˜”ì–´ìš”.`);
    }

    // â”€â”€ ì†ê°€ë½ ê°œìˆ˜ ë§ì¶”ê¸° ëª¨ë“œ â”€â”€
    let FINGER_TOTAL = 10;
    let fingerRound = 0;
    let fingerCorrect = 0;
    let fingerWrong = 0;
    let fingerStartTime = 0;
    let fingerRange = 5;
    let fingerAnswer = 0;
    let fingerFirstTry = true;
    let fingerQuestions = [];

    function startFinger(range) {
        fingerRange = range;
        fingerRound = 0;
        fingerCorrect = 0;
        fingerWrong = 0;
        fingerStartTime = Date.now();

        // ê° ìˆ«ìê°€ ì •í™•íˆ 1íšŒì”© ì¶œì œ (ê²¹ì¹¨ ì—†ìŒ)
        fingerQuestions = [];
        for (let i = 1; i <= fingerRange; i++) fingerQuestions.push(i);
        shuffle(fingerQuestions);
        FINGER_TOTAL = fingerQuestions.length;

        document.getElementById('start-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('finger-view').classList.remove('hidden');

        if (window.speechSynthesis) speechSynthesis.speak(new SpeechSynthesisUtterance(''));
        nextFingerRound();
    }

    let fingerLocked = false; // ì •ë‹µ í›„ ë‹¤ìŒ ë¬¸ì œ ì „í™˜ ì¤‘ í„°ì¹˜ ë°©ì§€

    function nextFingerRound() {
        fingerRound++;
        fingerFirstTry = true;
        fingerLocked = false;

        document.getElementById('finger-label').textContent = `ë¬¸ì œ ${fingerRound} / ${FINGER_TOTAL}`;
        document.getElementById('finger-progress').style.width = `${(fingerRound - 1) / FINGER_TOTAL * 100}%`;
        document.getElementById('finger-score').textContent = fingerCorrect;
        document.getElementById('finger-feedback').textContent = '';
        document.getElementById('finger-hint').textContent = 'ì†ê°€ë½ì´ ëª‡ ê°œì¼ê¹Œìš”?';
        document.getElementById('finger-hint').style.color = '#6BADE8';

        // ë¯¸ë¦¬ ìƒì„±ëœ ë¬¸ì œ ëª©ë¡ì—ì„œ ì •ë‹µ ê°€ì ¸ì˜¤ê¸°
        fingerAnswer = fingerQuestions[fingerRound - 1];

        // ì†ê°€ë½ ë Œë”ë§
        document.getElementById('finger-display').innerHTML = getHandHTML(fingerAnswer);

        // ì„ íƒì§€ ìƒì„±: ì •ë‹µ 1ê°œ + ì˜¤ë‹µ 3ê°œ
        const choices = [fingerAnswer];
        while (choices.length < 4) {
            const n = Math.floor(Math.random() * fingerRange) + 1;
            if (!choices.includes(n)) choices.push(n);
        }
        shuffle(choices);

        // ì¹© ë Œë”ë§
        const chipsEl = document.getElementById('finger-chips');
        chipsEl.innerHTML = '';
        choices.forEach(n => {
            const chip = document.createElement('div');
            chip.className = 'finger-chip';
            chip.textContent = n;
            chip.dataset.num = n;
            chip.addEventListener('click', () => handleFingerTap(chip, n));
            chipsEl.appendChild(chip);
        });

        // ì¶©ë™ë°©ì§€
        clearImpulseTimer();
        applyImpulseDelay(chipsEl, chipsEl.parentElement);
    }

    function handleFingerTap(chip, value) {
        if (fingerLocked) return;

        if (value === fingerAnswer) {
            // ì •ë‹µ
            fingerLocked = true;
            chip.classList.add('correct-tap');
            if (fingerFirstTry) fingerCorrect++;

            document.getElementById('finger-score').textContent = fingerCorrect;
            document.getElementById('finger-progress').style.width = `${fingerRound / FINGER_TOTAL * 100}%`;

            const fb = document.getElementById('finger-feedback');
            fb.textContent = 'ì •ë‹µì´ì—ìš”! ğŸ‰';
            fb.style.color = '#5BC886';
            speak(`${nativeNum(fingerAnswer)}ê°œ, ì •ë‹µì´ì—ìš”.`);

            // ë‚˜ë¨¸ì§€ ì¹© ë¹„í™œì„±í™”
            document.querySelectorAll('#finger-chips .finger-chip').forEach(c => {
                if (c !== chip) c.classList.add('disabled');
            });

            if (fingerRound >= FINGER_TOTAL) {
                setTimeout(showFingerResult, 1500);
            } else {
                setTimeout(nextFingerRound, 1300);
            }
        } else {
            // ì˜¤ë‹µ
            fingerWrong++;
            fingerFirstTry = false;
            chip.classList.add('wrong-tap');
            setTimeout(() => chip.classList.remove('wrong-tap'), 400);
            const fb = document.getElementById('finger-feedback');
            fb.textContent = 'ë‹¤ì‹œ ì„¸ì–´ë³¼ê¹Œìš”?';
            fb.style.color = '#F07070';
            speak('ë‹¤ì‹œ ì„¸ì–´ë´ìš”.');
        }
    }

    function showFingerResult() {
        const sec = Math.floor((Date.now() - fingerStartTime) / 1000);
        document.getElementById('finger-view').classList.add('hidden');
        document.getElementById('result-view').classList.remove('hidden');
        document.getElementById('r-range').textContent = `ì†ê°€ë½ 1~${fingerRange}`;
        document.getElementById('r-time').textContent = `${sec}ì´ˆ`;
        document.getElementById('r-wrong').textContent = `${fingerWrong}ë²ˆ`;
        speak(`ë‹¤ í’€ì—ˆì–´ìš”. ${nativeNum(fingerCorrect)} ë¬¸ì œ ë§í˜”ì–´ìš”.`);
    }

    // â”€â”€ ì†ê°€ë½ SVG ìƒì„± (ì‚¬ì‹¤ì  ì¼ëŸ¬ìŠ¤íŠ¸) â”€â”€
    function getHandHTML(count) {
        return `<img src="images/${count}.png" alt="ì†ê°€ë½ ${count}ê°œ" class="hand-image">`;
    }

    function scatterPositions(count, areaW, areaH, chipSize) {
        const pad = 4;
        const positions = [];
        const maxW = Math.max(areaW - chipSize - pad * 2, chipSize);
        const maxH = Math.max(areaH - chipSize - pad * 2, chipSize);
        for (let i = 0; i < count; i++) {
            let x, y, attempts = 0, ok = false;
            while (!ok && attempts < 200) {
                x = pad + Math.random() * maxW;
                y = pad + Math.random() * maxH;
                ok = true;
                for (const p of positions) {
                    const dx = p.x - x, dy = p.y - y;
                    if (Math.sqrt(dx * dx + dy * dy) < chipSize + 2) {
                        ok = false; break;
                    }
                }
                attempts++;
            }
            positions.push({ x, y });
        }
        return positions;
    }

    function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
    }

    // ê³ ìœ ì–´ ìˆ˜ì‚¬ (ë¬¸ì œ, ê°œ ë“± ë‹¨ìœ„ ì•ì— ì‚¬ìš©)
    function nativeNum(n) {
        const w = ['', 'í•œ', 'ë‘', 'ì„¸', 'ë„¤', 'ë‹¤ì„¯', 'ì—¬ì„¯', 'ì¼ê³±', 'ì—¬ëŸ', 'ì•„í™‰', 'ì—´'];
        return w[n] || String(n);
    }

    function speak(text) {
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ko-KR'; u.rate = 0.9;
        setTimeout(() => window.speechSynthesis.speak(u), 50);
    }

    // ì „ì—­ ì´ë²¤íŠ¸
    document.addEventListener('mousemove', e => moveHandler(e.clientX, e.clientY));
    document.addEventListener('mouseup', e => endHandler(e.clientX, e.clientY));
    document.addEventListener('touchmove', e => {
        if (dragging) { e.preventDefault(); const t = e.touches[0]; moveHandler(t.clientX, t.clientY); }
    }, { passive: false });
    document.addEventListener('touchend', e => {
        if (dragging) { const t = e.changedTouches[0]; endHandler(t.clientX, t.clientY); }
    });

    // TTS ì´ˆê¸°í™”
    if (window.speechSynthesis) {
        speechSynthesis.getVoices();
        if (speechSynthesis.onvoiceschanged !== undefined)
            speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    }
</script>

</body>
</html>
