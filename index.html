<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ÎäêÎ¶∞ÏïÑÏù¥ Ïà´Ïûê</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        warm: {
                            50: '#FDFCFA', 100: '#FAF7F2', 200: '#F3EDE4',
                            300: '#E8DFD2', 400: '#B8AD9E', 500: '#8C8070',
                            600: '#6B5F50', 700: '#4A4035', 800: '#2E261D',
                        },
                        app: {
                            blue: '#6BADE8', green: '#5BC886', orange: '#F0A050', red: '#F07070',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;900&display=swap');

        *, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0; padding: 0;
            background: #F5F1EB;
            min-height: 100dvh;
            display: flex; justify-content: center; align-items: flex-start;
        }

        .app {
            width: 100%; max-width: 600px;
            min-height: 100dvh;
            background: white;
            padding: 24px 16px;
            padding-top: max(24px, env(safe-area-inset-top));
            padding-bottom: max(24px, env(safe-area-inset-bottom));
            display: flex; flex-direction: column;
        }

        /* ÌÉúÎ∏îÎ¶ø ÎØ∏ÎîîÏñ¥ÏøºÎ¶¨: ÌïòÎã® ÌÜµÌï© */

        /* Í≤åÏûÑ ÏÑπÏÖò Ïª®ÌÖåÏù¥ÎÑà */
        .game-section {
            background: #FDFCFA;
            border: 1.5px solid #F0ECE6;
            border-radius: 18px;
            padding: 14px;
        }
        .game-section-header {
            display: flex; align-items: center; gap: 8px;
            margin-bottom: 10px; padding: 0 2px;
        }
        .game-section-title {
            font-size: 1rem; font-weight: 800; color: #4A4035;
        }
        .game-section-desc {
            font-size: 0.7rem; color: #B8AD9E;
        }

        /* ÏÑ§Ï†ï Ïª®Ìä∏Î°§ Í∑∏Î£π */
        .settings-group {
            background: white;
            border: 1.5px solid #F0ECE6;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .settings-row {
            display: flex; align-items: center;
            padding: 0;
        }
        .settings-row + .settings-row {
            border-top: 1px solid #F0ECE6;
        }
        .settings-label {
            width: 36px; flex-shrink: 0;
            font-size: 0.68rem; font-weight: 700;
            color: #B8AD9E;
            text-align: center;
            padding: 8px 0;
        }
        .settings-options {
            display: flex; flex: 1;
        }
        .settings-options .counting-mode-btn {
            flex: 1;
            padding: 8px 0;
            text-align: center;
            font-size: 0.72rem; font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
            border: none; border-radius: 0;
        }
        .settings-options .counting-mode-btn + .counting-mode-btn {
            border-left: 1px solid #F0ECE6;
        }

        /* Î™®Îìú Ïπ¥Îìú */
        .mode-card {
            transition: transform 0.12s, box-shadow 0.12s;
            cursor: pointer; user-select: none;
            border-left: 3.5px solid transparent !important;
        }
        .mode-card:active { transform: scale(0.97); }
        .mode-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.06); }

        /* ÎÇúÏù¥ÎèÑÎ≥Ñ Ïπ¥Îìú Ïï°ÏÑºÌä∏ ÏÉâÏÉÅ */
        .mode-card[data-range="5"]   { border-left-color: #5BC886 !important; }
        .mode-card[data-range="10"]  { border-left-color: #6BADE8 !important; }
        .mode-card[data-range="20"]  { border-left-color: #9B8FE8 !important; }
        .mode-card[data-range="30"]  { border-left-color: #F0A050 !important; }
        .mode-card[data-range="50"]  { border-left-color: #E87B7B !important; }
        .mode-card[data-range="100"] { border-left-color: #C46BE8 !important; }

        /* Ìôà Î≤ÑÌäº */
        .btn-home {
            width: 36px; height: 36px; border-radius: 10px;
            border: 2px solid #E8E2DA; background: white;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: background 0.15s;
            font-size: 1rem; color: #8C8070;
        }
        .btn-home:active { background: #F5F1EB; }

        /* ÌîÑÎ°úÍ∑∏Î†àÏä§ */
        .progress-track { height: 8px; border-radius: 99px; background: #F0ECE6; overflow: hidden; }
        .progress-bar {
            height: 100%; border-radius: 99px;
            background: linear-gradient(90deg, #6BADE8, #5BC886);
            transition: width 0.5s ease;
        }

        /* Ïä¨Î°Ø Í∑∏Î¶¨Îìú */
        .slots-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
            width: 100%;
        }

        /* ÎπàÏπ∏ Ïä¨Î°Ø */
        .slot {
            aspect-ratio: 1;
            width: 100%;
            border: 2.5px dashed #D0C8BC;
            border-radius: 12px;
            background: #FDFCFA;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; font-weight: 800;
            color: #D0C8BC;
            transition: all 0.2s;
            position: relative;
        }
        .slot .ghost-num {
            color: #E0D8CC;
            font-weight: 800;
            font-size: inherit;
            user-select: none;
            pointer-events: none;
        }
        .slot.drag-over {
            border-color: #6BADE8; border-style: solid;
            background: #EEF6FD;
            transform: scale(1.08);
        }
        .slot.filled {
            border: 2.5px solid #5BC886;
            background: #D4F5E0;
            color: #1A7A3A;
            cursor: default;
        }
        .slot.wrong {
            border-color: #F07070;
            background: #FDE8E8;
            animation: shake 0.4s ease;
        }

        /* Ìù©ÎøåÎ¶¨Í∏∞ ÏòÅÏó≠ */
        .scatter-area {
            position: relative;
            width: 100%;
            min-height: 220px;
        }

        /* ÎìúÎûòÍ∑∏ Ïà´Ïûê */
        .num-chip {
            width: 34px; height: 34px;
            border-radius: 50%;
            border: 2px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.78rem; font-weight: 800;
            color: #4A4035;
            cursor: grab;
            touch-action: none;
            user-select: none;
            position: absolute;
            transition: transform 0.1s, box-shadow 0.1s, opacity 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .num-chip:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
        .num-chip:active { cursor: grabbing; }
        .num-chip.dragging {
            opacity: 0.3;
        }
        .num-chip.placed {
            opacity: 0; pointer-events: none;
            transform: scale(0.5);
        }

        /* ÌîåÎ°úÌåÖ */
        .floating-num {
            position: fixed; z-index: 9999; pointer-events: none;
            width: 42px; height: 42px;
            border-radius: 12px;
            background: #4A4035;
            color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.98rem; font-weight: 900;
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.3s ease-out; }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.15); }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in { animation: pop 0.35s ease-out; }

        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ÎπàÏπ∏ ÎßûÏ∂îÍ∏∞ Ïπ¥Îìú */
        #quiz-cards {
            display: grid !important;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            justify-items: center;
        }
        #quiz-cards.quiz-cards-8 {
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
        }
        .quiz-card {
            width: 100%; max-width: 72px;
            aspect-ratio: 1;
            border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: 900;
            user-select: none;
            transition: all 0.2s;
        }
        .quiz-cards-8 .quiz-card {
            max-width: none;
            font-size: 1rem;
            border-radius: 12px;
        }
        .quiz-card.open {
            border: 2.5px solid #6BADE8;
            background: #EEF6FD;
            color: #2E7FD9;
        }
        .quiz-card.hidden-card {
            border: 2.5px dashed #D0C8BC;
            background: #FDFCFA;
            color: #D0C8BC;
            font-size: 1.2rem;
        }
        .quiz-card.hidden-card.drag-over {
            border-color: #6BADE8; border-style: solid;
            background: #D9EDFC;
            transform: scale(1.08);
        }
        .quiz-card.hidden-card.filled {
            border: 2.5px solid #5BC886;
            background: #D4F5E0;
            color: #1A7A3A;
        }
        .quiz-card.hidden-card.wrong {
            border-color: #F07070;
            background: #FDE8E8;
            animation: shake 0.4s ease;
        }
        /* quiz-card ÌÉúÎ∏îÎ¶ø: ÌïòÎã® ÌÜµÌï© */

        /* ÎπàÏπ∏ ÎßûÏ∂îÍ∏∞ Ïπ© */
        .quiz-chip {
            width: 56px; height: 56px;
            border-radius: 50%;
            border: 2.5px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; font-weight: 800;
            color: #4A4035;
            cursor: grab;
            touch-action: none;
            user-select: none;
            transition: transform 0.1s, box-shadow 0.1s, opacity 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .quiz-chip:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
        .quiz-chip:active { cursor: grabbing; }
        .quiz-chip.dragging { opacity: 0.3; }
        .quiz-chip.placed { opacity: 0; pointer-events: none; transform: scale(0.5); }

        /* ÏÑ§Ï†ï ÌÜ†Í∏Ä */
        .impulse-toggle {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 14px;
            border-radius: 14px;
            border: 1.5px solid #F0ECE6;
            background: #FDFCFA;
            transition: border-color 0.2s, background 0.2s;
        }
        .impulse-toggle.active { border-color: #C4AA82; background: #FAF5EE; }
        .toggle-switch {
            width: 40px; height: 22px;
            border-radius: 11px;
            background: #D0C8BC;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
            flex-shrink: 0;
        }
        .toggle-switch.on { background: #5BC886; }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 18px; height: 18px;
            border-radius: 50%;
            background: white;
            top: 2px; left: 2px;
            transition: transform 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
        }
        .toggle-switch.on::after { transform: translateX(18px); }
        .impulse-details {
            overflow: hidden;
            max-height: 0; opacity: 0;
            transition: max-height 0.3s, opacity 0.3s, margin 0.3s;
            margin-top: 0;
        }
        .impulse-details.show { max-height: 200px; opacity: 1; margin-top: 9px; }
        .impulse-mode-options {
            display: grid; grid-template-columns: 1fr 1fr; gap: 7px;
            margin-bottom: 9px;
        }
        .impulse-mode-btn {
            display: flex; flex-direction: column; align-items: center;
            padding: 9px 7px;
            border-radius: 13px;
            border: 2px solid #E8E2DA;
            background: white;
            cursor: pointer;
            transition: all 0.15s;
        }
        .impulse-mode-btn.selected { border-color: #C4AA82; background: #FAF5EE; }
        .impulse-mode-icon { font-size: 1.08rem; margin-bottom: 2px; }
        .impulse-mode-label { font-size: 0.72rem; font-weight: 700; color: #4A4035; }
        .impulse-mode-desc { font-size: 0.59rem; color: #B8AD9E; margin-top: 1px; }
        .delay-options {
            display: flex; gap: 4px;
            flex-wrap: wrap; justify-content: center;
        }
        .delay-btn {
            min-width: 34px; height: 27px; padding: 0 5px;
            border-radius: 14px;
            border: 2px solid #E8E2DA;
            background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.68rem; font-weight: 700;
            color: #6B5F50;
            cursor: pointer;
            transition: all 0.15s;
        }
        .delay-btn.selected { border-color: #C4AA82; background: #FAF5EE; color: #7B6545; }
        /* Ï∂©ÎèôÎ∞©ÏßÄ: Î≥¥Í∏∞ Ïà®ÍπÄ / ÏÑ†ÌÉù Ïû†Í∏à */
        /* ÏùΩÍ∏∞ Î™®Îìú ÏÑ†ÌÉù */
        .counting-mode-btn {
            background: white; color: #8C8070; border: none;
        }
        .counting-mode-btn.selected {
            background: #FAF5EE; color: #7B6545;
        }

        /* Î™®Îìú ÏïÑÏù¥ÏΩò Ïï†ÎãàÎ©îÏù¥ÏÖò */
        /* Ïà´Ïûê ÏàúÏÑú: 3Ïπ∏ Ïä¨Î°ØÏóê 1,2,3Ïù¥ Ï∞®Î°ÄÎ°ú Ï±ÑÏõåÏßê */
        .icon-order {
            width: 72px; height: 36px;
            display: flex; align-items: center; gap: 4px;
            flex-shrink: 0;
        }
        .icon-order .slot-box {
            width: 20px; height: 28px; border-radius: 5px;
            border: 2px dashed #D0C8BC;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 900; color: white;
            position: relative; overflow: hidden;
        }
        .icon-order .slot-box .num-fill {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            border-radius: 4px;
        }
        .icon-order .slot-box:nth-child(1) .num-fill {
            background: #5BC886; animation: orderFill1 3.5s ease infinite;
        }
        .icon-order .slot-box:nth-child(2) .num-fill {
            background: #5BC886; animation: orderFill2 3.5s ease infinite;
        }
        .icon-order .slot-box:nth-child(3) .num-fill {
            background: #5BC886; animation: orderFill3 3.5s ease infinite;
        }
        @keyframes orderFill1 {
            0%, 10% { opacity: 0; transform: translateY(12px); }
            20%, 65% { opacity: 1; transform: translateY(0); }
            78%, 100% { opacity: 0; transform: translateY(0); }
        }
        @keyframes orderFill2 {
            0%, 25% { opacity: 0; transform: translateY(12px); }
            35%, 65% { opacity: 1; transform: translateY(0); }
            78%, 100% { opacity: 0; transform: translateY(0); }
        }
        @keyframes orderFill3 {
            0%, 40% { opacity: 0; transform: translateY(12px); }
            50%, 65% { opacity: 1; transform: translateY(0); }
            78%, 100% { opacity: 0; transform: translateY(0); }
        }
        /* ÎπàÏπ∏ ÎßûÏ∂îÍ∏∞: 1 [?‚Üí2] 3 */
        .icon-blank {
            width: 72px; height: 36px;
            display: inline-flex; align-items: center; gap: 4px;
            flex-shrink: 0; overflow: visible;
        }
        .icon-blank .ib-card {
            width: 20px; height: 28px; border-radius: 5px;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 900;
            flex-shrink: 0;
        }
        .icon-blank .ib-card.ib-fixed {
            background: #EEF6FD; border: 2px solid #6BADE8; color: #2E7FD9;
        }
        .icon-blank .ib-card.ib-empty {
            border: 2px dashed #D0C8BC; color: #D0C8BC;
            position: relative; overflow: hidden;
        }
        .icon-blank .ib-card.ib-empty .ib-q {
            position: absolute;
            animation: ibReveal 2.5s ease infinite;
        }
        .icon-blank .ib-card.ib-empty .ib-ans {
            position: absolute; inset: 0;
            background: #D4F5E0; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 900; color: #1A7A3A;
            animation: ibFill 2.5s ease infinite;
        }
        @keyframes ibReveal {
            0%, 40% { opacity: 1; }
            50%, 90% { opacity: 0; }
            100% { opacity: 1; }
        }
        @keyframes ibFill {
            0%, 40% { opacity: 0; }
            50%, 85% { opacity: 1; }
            90%, 100% { opacity: 0; }
        }

        /* Ï†ÑÏ≤¥ ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞: ÌûåÌä∏ 2Í∞ú + ÎÇòÎ®∏ÏßÄ Ï±ÑÏö∞Í∏∞ */
        .icon-fill {
            width: 72px; height: 36px;
            display: inline-flex; align-items: center; gap: 2px;
            flex-shrink: 0;
        }
        .icon-fill .fb {
            width: 13px; height: 22px; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 9px; font-weight: 900;
            flex-shrink: 0; position: relative; overflow: hidden;
        }
        .icon-fill .fb.fb-hint {
            background: #FFF3E0; border: 1.5px solid #FFB74D; color: #E65100;
        }
        .icon-fill .fb.fb-empty {
            border: 1.5px dashed #D0C8BC;
        }
        .icon-fill .fb.fb-empty .fb-num {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            background: #E8F5E9; border-radius: 3px;
            font-size: 10px; font-weight: 900; color: #388E3C;
        }
        .icon-fill .fb:nth-child(1) .fb-num { animation: fillDrop 3s ease infinite; }
        .icon-fill .fb:nth-child(3) .fb-num { animation: fillDrop 3s ease 0.5s infinite; }
        .icon-fill .fb:nth-child(4) .fb-num { animation: fillDrop 3s ease 1s infinite; }
        @keyframes fillDrop {
            0%, 15% { opacity: 0; transform: translateY(-10px) scale(0.7); }
            25%, 65% { opacity: 1; transform: translateY(0) scale(1); }
            78%, 100% { opacity: 0; transform: translateY(0) scale(1); }
        }

        .chips-hidden { visibility: hidden; }
        .chips-locked { pointer-events: none; opacity: 0.45; }

        .reveal-btn {
            display: block;
            width: 100%;
            max-width: 320px;
            margin: 0 auto 12px;
            padding: 14px 0;
            border-radius: 14px;
            border: 2px solid #C4AA82;
            background: #FAF5EE;
            color: #7B6545;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }
        .reveal-btn:active {
            background: #F0E6D6;
            transform: scale(0.98);
        }

        .delay-countdown {
            text-align: center;
            font-size: 1.5rem; font-weight: 900;
            color: #C4AA82;
            padding: 16px 0;
            animation: pulse-count 1s ease infinite;
        }
        @keyframes pulse-count {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.7; }
        }

        /* ‚îÄ‚îÄ Î∞òÏùëÌòï: Î™®Î∞îÏùº (Í∏∞Î≥∏Í∞í Í∞ïÌôî) ‚îÄ‚îÄ */
        @media (max-width: 374px) {
            .app { padding: 16px 10px; }
            .slot { border-radius: 8px; font-size: 0.9rem; }
            .num-chip { width: 29px; height: 29px; font-size: 0.65rem; }
            .quiz-card { max-width: 56px; font-size: 1.15rem; border-radius: 12px; }
            .quiz-cards-8 .quiz-card { max-width: none; font-size: 0.8rem; border-radius: 8px; }
            .quiz-chip { width: 48px; height: 48px; font-size: 1.05rem; }
            .floating-num { width: 36px; height: 36px; font-size: 0.78rem; }
        }

        /* ‚îÄ‚îÄ Î∞òÏùëÌòï: ÌÉúÎ∏îÎ¶ø (768px+) ‚îÄ‚îÄ */
        @media (min-width: 768px) {
            body { align-items: center; padding: 32px; }
            .app {
                max-width: 720px; min-height: auto;
                border-radius: 32px;
                box-shadow: 0 8px 48px rgba(0,0,0,0.07), 0 1px 4px rgba(0,0,0,0.04);
                padding: 40px 36px;
            }
            .game-section { padding: 20px; border-radius: 22px; }
            .game-section-title { font-size: 1.15rem; }
            .settings-group { border-radius: 14px; }
            .settings-label { width: 44px; font-size: 0.75rem; }
            .settings-options .counting-mode-btn { font-size: 0.82rem; padding: 10px 0; }
            .btn-home { width: 44px; height: 44px; border-radius: 12px; }
            .btn-home svg { width: 22px; height: 22px; }
            .progress-track { height: 10px; }
            .mode-card { padding: 20px !important; }
            .mode-card p:first-child { font-size: 1.4rem !important; }
            .mode-card p:last-child { font-size: 0.85rem !important; }
            .slots-grid { gap: 6px; }
            .slot { border-radius: 14px; font-size: 1.3rem; border-width: 3px; }
            .num-chip { width: 42px; height: 42px; font-size: 0.91rem; }
            .floating-num { width: 47px; height: 47px; font-size: 1.04rem; border-radius: 12px; }
            .quiz-card { max-width: 80px; font-size: 1.7rem; border-radius: 18px; }
            .quiz-cards-8 .quiz-card { max-width: none; font-size: 1.2rem; border-radius: 14px; }
            .quiz-chip { width: 68px; height: 68px; font-size: 1.4rem; }
            #quiz-chips { gap: 16px !important; }
            .impulse-toggle { padding: 16px 20px; border-radius: 20px; }
            .delay-btn { min-width: 44px; height: 36px; font-size: 0.85rem; }
            .delay-countdown { font-size: 1.8rem; }
        }

        /* ‚îÄ‚îÄ Î∞òÏùëÌòï: ÌÅ∞ ÌÉúÎ∏îÎ¶ø (1024px+) ‚îÄ‚îÄ */
        @media (min-width: 1024px) {
            .app { max-width: 800px; padding: 48px 44px; }
            .mode-card p:first-child { font-size: 1.6rem !important; }
            .slot { font-size: 1.4rem; }
            .num-chip { width: 47px; height: 47px; font-size: 0.98rem; }
            .quiz-card { max-width: 90px; font-size: 1.9rem; }
            .quiz-cards-8 .quiz-card { max-width: none; font-size: 1.35rem; }
            .quiz-chip { width: 76px; height: 76px; font-size: 1.55rem; }
        }
        /* ‚îÄ‚îÄ Login View ‚îÄ‚îÄ */
        .login-view {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          flex: 1;
          min-height: 100dvh;
          padding: 40px 20px;
        }

        .login-logo-area {
          text-align: center;
          margin-bottom: 48px;
        }

        .login-logo-area h1 {
          font-size: 1.875rem;
          font-weight: 900;
          letter-spacing: -0.025em;
          margin-top: 8px;
        }

        .login-subtitle {
          color: #B8AD9E;
          font-size: 0.9375rem;
          margin-top: 4px;
        }

        .login-buttons {
          width: 100%;
          max-width: 320px;
          display: flex;
          flex-direction: column;
          gap: 12px;
        }

        .login-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 10px;
          width: 100%;
          padding: 14px 20px;
          border-radius: 12px;
          font-size: 0.9375rem;
          font-weight: 600;
          font-family: 'Noto Sans KR', sans-serif;
          border: none;
          cursor: pointer;
          transition: transform 0.1s, opacity 0.15s;
        }
        .login-btn:active { transform: scale(0.97); }
        .login-btn svg { flex-shrink: 0; }
        .login-btn.kakao { background: #FEE500; color: #191919; }
        .login-btn.naver { background: #03C75A; color: #FFFFFF; }
        .login-btn.google { background: #FFFFFF; color: #444444; border: 1.5px solid #DADCE0; }
        .login-btn.facebook { background: #1877F2; color: #FFFFFF; }

        .logout-btn {
          background: none;
          border: 1.5px solid #E8E2DA;
          border-radius: 8px;
          padding: 6px 14px;
          font-size: 0.75rem;
          font-weight: 600;
          color: #B8AD9E;
          cursor: pointer;
          font-family: 'Noto Sans KR', sans-serif;
          transition: background 0.15s;
        }
        .logout-btn:hover { background: #F5F1EB; }
    </style>
</head>
<body>

<div class="app">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="login-view" class="login-view">
        <div class="login-logo-area">
            <div class="inline-block mb-2">
                <svg viewBox="0 0 120 100" width="120" height="100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <ellipse cx="30" cy="72" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(-20 30 72)"/>
                    <ellipse cx="78" cy="76" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(15 78 76)"/>
                    <ellipse cx="28" cy="54" rx="9" ry="5.5" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(-10 28 54)"/>
                    <path d="M18 60 L10 55" stroke="#F2DC8C" stroke-width="4" stroke-linecap="round"/>
                    <ellipse cx="55" cy="58" rx="35" ry="20" fill="#F5E6C8" stroke="#3A9B6A" stroke-width="2"/>
                    <ellipse cx="52" cy="42" rx="32" ry="28" fill="#7EDCAA" stroke="#3A9B6A" stroke-width="2.5"/>
                    <path d="M52 18 L42 32 L42 48 L52 58 L62 48 L62 32 Z" fill="none" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="42" y1="32" x2="24" y2="38" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="62" y1="32" x2="80" y2="38" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="42" y1="48" x2="26" y2="56" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="62" y1="48" x2="78" y2="56" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <ellipse cx="42" cy="26" rx="6" ry="4" fill="white" opacity="0.35" transform="rotate(-15 42 26)"/>
                    <ellipse cx="62" cy="36" rx="4" ry="3" fill="white" opacity="0.2"/>
                    <ellipse cx="92" cy="40" rx="17" ry="15" fill="#F5E6C8" stroke="#3A9B6A" stroke-width="2.5"/>
                    <ellipse cx="82" cy="72" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(10 82 72)"/>
                    <circle cx="99" cy="35" r="4" fill="white" stroke="#3A9B6A" stroke-width="1.5"/>
                    <circle cx="100" cy="34" r="2.5" fill="#3A9B6A"/>
                    <circle cx="101" cy="33" r="1" fill="white"/>
                    <circle cx="100" cy="44" r="3.5" fill="#F0A050" opacity="0.4"/>
                    <path d="M94 46 Q98 50 103 46" fill="none" stroke="#3A9B6A" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            <h1><span style="color:#2E7FD9;">ÎäêÎ¶∞</span><span style="color:#F0901E;">ÏïÑÏù¥</span> <span style="color:#4A4035;">Ïà´Ïûê</span></h1>
            <p class="login-subtitle">Ïà´ÏûêÎ•º ÏàúÏÑúÎåÄÎ°ú Î∞∞ÏõåÎ≥¥ÏÑ∏Ïöî.</p>
        </div>
        <div class="login-buttons">
            <button class="login-btn kakao" onclick="socialLogin('kakao')">
                <svg width="20" height="20" viewBox="0 0 20 20"><path d="M10 1C4.477 1 0 4.477 0 8.667c0 2.7 1.753 5.072 4.393 6.413-.192.717-.694 2.6-.794 3.004-.124.497.182.49.383.356.158-.105 2.51-1.708 3.525-2.398.8.118 1.628.18 2.493.18 5.523 0 10-3.477 10-7.555C20 4.477 15.523 1 10 1z" fill="#191919"/></svg>
                Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏
            </button>
            <button class="login-btn naver" onclick="socialLogin('naver')">
                <svg width="20" height="20" viewBox="0 0 20 20"><path d="M13.57 10.684L6.066 0H0v20h6.43V9.316L13.934 20H20V0h-6.43v10.684z" fill="white"/></svg>
                ÎÑ§Ïù¥Î≤Ñ Î°úÍ∑∏Ïù∏
            </button>
            <button class="login-btn google" onclick="socialLogin('google')">
                <svg width="20" height="20" viewBox="0 0 48 48"><path d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 12.955 4 4 12.955 4 24s8.955 20 20 20 20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z" fill="#FFC107"/><path d="M6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 16.318 4 9.656 8.337 6.306 14.691z" fill="#FF3D00"/><path d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0124 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z" fill="#4CAF50"/><path d="M43.611 20.083H42V20H24v8h11.303a12.04 12.04 0 01-4.087 5.571l.001-.001 6.19 5.238C36.971 39.205 44 34 44 24c0-1.341-.138-2.65-.389-3.917z" fill="#1976D2"/></svg>
                Google Î°úÍ∑∏Ïù∏
            </button>
            <button class="login-btn facebook" onclick="socialLogin('facebook')">
                <svg width="20" height="20" viewBox="0 0 20 20"><path d="M20 10c0-5.523-4.477-10-10-10S0 4.477 0 10c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V10h2.54V7.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V10h2.773l-.443 2.89h-2.33v6.988C16.343 19.128 20 14.991 20 10z" fill="white"/></svg>
                Facebook Î°úÍ∑∏Ïù∏
            </button>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ÏãúÏûë ÌôîÎ©¥ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="start-view" class="flex flex-col flex-1 hidden">
        <div class="text-center pt-2 pb-3">
            <div class="inline-block mb-2">
                <svg viewBox="0 0 120 100" width="90" height="75" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <ellipse cx="30" cy="72" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(-20 30 72)"/>
                    <ellipse cx="78" cy="76" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(15 78 76)"/>
                    <ellipse cx="28" cy="54" rx="9" ry="5.5" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(-10 28 54)"/>
                    <path d="M18 60 L10 55" stroke="#F2DC8C" stroke-width="4" stroke-linecap="round"/>
                    <ellipse cx="55" cy="58" rx="35" ry="20" fill="#F5E6C8" stroke="#3A9B6A" stroke-width="2"/>
                    <ellipse cx="52" cy="42" rx="32" ry="28" fill="#7EDCAA" stroke="#3A9B6A" stroke-width="2.5"/>
                    <path d="M52 18 L42 32 L42 48 L52 58 L62 48 L62 32 Z" fill="none" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="42" y1="32" x2="24" y2="38" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="62" y1="32" x2="80" y2="38" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="42" y1="48" x2="26" y2="56" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <line x1="62" y1="48" x2="78" y2="56" stroke="#3A9B6A" stroke-width="1.3" opacity="0.35"/>
                    <ellipse cx="42" cy="26" rx="6" ry="4" fill="white" opacity="0.35" transform="rotate(-15 42 26)"/>
                    <ellipse cx="62" cy="36" rx="4" ry="3" fill="white" opacity="0.2"/>
                    <ellipse cx="92" cy="40" rx="17" ry="15" fill="#F5E6C8" stroke="#3A9B6A" stroke-width="2.5"/>
                    <ellipse cx="82" cy="72" rx="10" ry="6" fill="#F2DC8C" stroke="#3A9B6A" stroke-width="2" transform="rotate(10 82 72)"/>
                    <circle cx="99" cy="35" r="4" fill="white" stroke="#3A9B6A" stroke-width="1.5"/>
                    <circle cx="100" cy="34" r="2.5" fill="#3A9B6A"/>
                    <circle cx="101" cy="33" r="1" fill="white"/>
                    <circle cx="100" cy="44" r="3.5" fill="#F0A050" opacity="0.4"/>
                    <path d="M94 46 Q98 50 103 46" fill="none" stroke="#3A9B6A" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            <h1 class="text-2xl font-black tracking-tight">
                <span style="color:#2E7FD9;">ÎäêÎ¶∞</span><span style="color:#F0901E;">ÏïÑÏù¥</span> <span style="color:#4A4035;">Ïà´Ïûê</span>
            </h1>
            <div class="mt-2"><button class="logout-btn" onclick="socialLogout()">Î°úÍ∑∏ÏïÑÏõÉ</button></div>
        </div>

        <div style="height:8px;"></div>

        <div class="flex flex-col gap-3 flex-1">
            <!-- Ïà´Ïûê ÏàúÏÑú ÎßûÏ∂îÍ∏∞ -->
            <div class="game-section">
                <div class="game-section-header">
                    <div class="icon-order">
                        <div class="slot-box"><span class="num-fill">1</span></div>
                        <div class="slot-box"><span class="num-fill">2</span></div>
                        <div class="slot-box"><span class="num-fill">3</span></div>
                    </div>
                    <span class="game-section-title">Ïà´Ïûê ÏàúÏÑú ÎßûÏ∂îÍ∏∞</span>
                    <span class="game-section-desc">ÎÅåÏñ¥ÏÑú ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞</span>
                </div>
                <div class="settings-group">
                    <div class="settings-row">
                        <span class="settings-label">ÏùΩÍ∏∞</span>
                        <div class="settings-options">
                            <button onclick="setCountingMode('sino')" data-cmode="sino"
                                    class="counting-mode-btn selected">Ïùº, Ïù¥, ÏÇº</button>
                            <button onclick="setCountingMode('native')" data-cmode="native"
                                    class="counting-mode-btn">ÌïòÎÇò, Îëò, ÏÖã</button>
                        </div>
                    </div>
                    <div class="settings-row">
                        <span class="settings-label">ÏàúÏÑú</span>
                        <div class="settings-options">
                            <button onclick="setOrderMode('asc')" data-omode="asc"
                                    class="counting-mode-btn selected">1, 2, 3 Ï†ïÎ∞©Ìñ•</button>
                            <button onclick="setOrderMode('desc')" data-omode="desc"
                                    class="counting-mode-btn">10, 9, 8 Ïó≠Î∞©Ìñ•</button>
                        </div>
                    </div>
                    <div class="settings-row">
                        <span class="settings-label">ÎπàÏπ∏</span>
                        <div class="settings-options">
                            <button onclick="setGhostMode(false)" data-gmode="off"
                                    class="counting-mode-btn selected">ÌûåÌä∏ Ïà®ÍπÄ</button>
                            <button onclick="setGhostMode(true)" data-gmode="on"
                                    class="counting-mode-btn">ÌûåÌä∏ Î≥¥ÏûÑ</button>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="startGame(5)" data-range="5"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 5</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">Î∞ò Ï§Ñ</p>
                    </button>
                    <button onclick="startGame(10)" data-range="10"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 10</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">Ìïú Ï§Ñ</p>
                    </button>
                    <button onclick="startGame(20)" data-range="20"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 20</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">Îëê Ï§Ñ</p>
                    </button>
                    <button onclick="startGame(30)" data-range="30"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 30</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">ÏÑ∏ Ï§Ñ</p>
                    </button>
                    <button onclick="startGame(50)" data-range="50"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 50</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">Îã§ÏÑØ Ï§Ñ</p>
                    </button>
                    <button onclick="startGame(100, 50)" data-range="100"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">50 Î∂ÄÌÑ∞ 100</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">Îã§ÏÑØ Ï§Ñ</p>
                    </button>
                </div>
            </div>

            <!-- ÎπàÏπ∏ ÎßûÏ∂îÍ∏∞ -->
            <div class="game-section">
                <div class="game-section-header">
                    <div class="icon-blank">
                        <div class="ib-card ib-fixed">1</div>
                        <div class="ib-card ib-empty"><span class="ib-q">?</span><span class="ib-ans">2</span></div>
                        <div class="ib-card ib-fixed">3</div>
                    </div>
                    <span class="game-section-title">Î∂ÄÎ∂Ñ ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞</span>
                    <span class="game-section-desc">Ïà®ÏùÄ Ïà´ÏûêÎ•º Ï∞æÏïÑÏöî</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="startQuiz(5)" data-range="5"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 5</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">5Í∞ú Ï§ë 2Í∞ú Ïà®ÍπÄ</p>
                    </button>
                    <button onclick="startQuiz(10)" data-range="10"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 10</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8Í∞ú Ï§ë 4Í∞ú Ïà®ÍπÄ</p>
                    </button>
                    <button onclick="startQuiz(20)" data-range="20"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 20</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8Í∞ú Ï§ë 4Í∞ú Ïà®ÍπÄ</p>
                    </button>
                    <button onclick="startQuiz(30)" data-range="30"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 30</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8Í∞ú Ï§ë 4Í∞ú Ïà®ÍπÄ</p>
                    </button>
                    <button onclick="startQuiz(50)" data-range="50"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 50</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8Í∞ú Ï§ë 4Í∞ú Ïà®ÍπÄ</p>
                    </button>
                    <button onclick="startQuiz(100)" data-range="100"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 100</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">8Í∞ú Ï§ë 4Í∞ú Ïà®ÍπÄ</p>
                    </button>
                </div>
            </div>

            <!-- Ï†ÑÏ≤¥ ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞ -->
            <div class="game-section">
                <div class="game-section-header">
                    <div class="icon-fill">
                        <div class="fb fb-empty"><span class="fb-num">1</span></div>
                        <div class="fb fb-hint">2</div>
                        <div class="fb fb-empty"><span class="fb-num">3</span></div>
                        <div class="fb fb-empty"><span class="fb-num">4</span></div>
                        <div class="fb fb-hint">5</div>
                    </div>
                    <span class="game-section-title">Ï†ÑÏ≤¥ ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞</span>
                    <span class="game-section-desc">ÌûåÌä∏Î•º Î≥¥Í≥† ÎÇòÎ®∏ÏßÄÎ•º Ï±ÑÏõåÏöî</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="startFillGame(5)" data-range="5"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 5</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">2Í∞ú ÌûåÌä∏</p>
                    </button>
                    <button onclick="startFillGame(10)" data-range="10"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 10</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">3Í∞ú ÌûåÌä∏</p>
                    </button>
                    <button onclick="startFillGame(20)" data-range="20"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 20</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">6Í∞ú ÌûåÌä∏</p>
                    </button>
                    <button onclick="startFillGame(30)" data-range="30"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 30</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">9Í∞ú ÌûåÌä∏</p>
                    </button>
                    <button onclick="startFillGame(50)" data-range="50"
                            class="mode-card rounded-xl p-3 text-left border-2" style="border-color:#E8E2DA; background:white;">
                        <p class="text-base font-bold" style="color:#4A4035;">1 Î∂ÄÌÑ∞ 50</p>
                        <p class="text-xs mt-0.5" style="color:#B8AD9E;">15Í∞ú ÌûåÌä∏</p>
                    </button>
                </div>
            </div>

            <div style="margin-top: auto;"></div>

            <!-- ÏùåÏÑ± + Ï∂©ÎèôÎ∞©ÏßÄ -->
            <div class="flex gap-2">
                <div class="impulse-toggle flex-1" id="tts-toggle" onclick="toggleTTS()">
                    <div class="toggle-switch on" id="tts-switch"></div>
                    <div>
                        <p style="font-size:0.81rem; font-weight:600; color:#4A4035;">ÏùåÏÑ±</p>
                        <p style="font-size:0.68rem; color:#B8AD9E;">Ï†ïÎãµ/Ïò§Îãµ ÏùåÏÑ± ÏïàÎÇ¥</p>
                    </div>
                </div>
            </div>

            <div style="margin-top: -6px;">
                <div class="impulse-toggle active" id="impulse-toggle" onclick="toggleImpulse()">
                    <div class="toggle-switch on" id="impulse-switch"></div>
                    <div>
                        <p style="font-size:0.81rem; font-weight:600; color:#4A4035;">Ï∂©ÎèôÎ∞©ÏßÄ</p>
                        <p style="font-size:0.68rem; color:#B8AD9E;">ÏÉùÍ∞ÅÌï† ÏãúÍ∞ÑÏùÑ Ï§òÏöî</p>
                    </div>
                </div>
                <div class="impulse-details show" id="impulse-details">
                <div class="impulse-mode-options">
                    <button class="impulse-mode-btn" onclick="setImpulseMode('hide')" data-mode="hide">
                        <span class="impulse-mode-icon">üëÄ</span>
                        <span class="impulse-mode-label">Î≥¥Í∏∞ ÌôïÏù∏</span>
                        <span class="impulse-mode-desc">Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ Î≥¥Í∏∞Í∞Ä ÎÇòÌÉÄÎÇòÏöî</span>
                    </button>
                    <button class="impulse-mode-btn selected" onclick="setImpulseMode('lock')" data-mode="lock">
                        <span class="impulse-mode-icon">üîí</span>
                        <span class="impulse-mode-label">ÏÑ†ÌÉù Ïû†Í∏à</span>
                        <span class="impulse-mode-desc">NÏ¥à ÎèôÏïà ÏÑ†ÌÉùÌï† Ïàò ÏóÜÏñ¥Ïöî</span>
                    </button>
                </div>
                <div class="delay-options show">
                    <button class="delay-btn" onclick="setDelay(1)" data-delay="1">1Ï¥à</button>
                    <button class="delay-btn" onclick="setDelay(2)" data-delay="2">2Ï¥à</button>
                    <button class="delay-btn" onclick="setDelay(3)" data-delay="3">3Ï¥à</button>
                    <button class="delay-btn" onclick="setDelay(4)" data-delay="4">4Ï¥à</button>
                    <button class="delay-btn selected" onclick="setDelay(5)" data-delay="5">5Ï¥à</button>
                    <button class="delay-btn" onclick="setDelay(6)" data-delay="6">6Ï¥à</button>
                    <button class="delay-btn" onclick="setDelay(7)" data-delay="7">7Ï¥à</button>
                    <button class="delay-btn" onclick="setDelay(8)" data-delay="8">8Ï¥à</button>
                    <button class="delay-btn" onclick="setDelay(9)" data-delay="9">9Ï¥à</button>
                    <button class="delay-btn" onclick="setDelay(10)" data-delay="10">10Ï¥à</button>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Í≤åÏûÑ ÌôîÎ©¥ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="game-view" class="hidden flex flex-col flex-1 fade-in">
        <!-- ÏÉÅÎã® Î∞î -->
        <div class="flex items-center gap-3 mb-4">
            <button onclick="goHome()" class="btn-home" title="Ìôà">
                <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-8 9 8M5 11v9a1 1 0 001 1h3m8 0h3a1 1 0 001-1v-9"/></svg>
            </button>
            <div class="flex-1">
                <div class="flex justify-between items-center mb-1">
                    <span id="game-label" class="text-xs font-medium" style="color:#B8AD9E;">1 Î∂ÄÌÑ∞ 10</span>
                    <span id="placed-label" class="text-xs font-medium" style="color:#B8AD9E;">0 / 10</span>
                </div>
                <div class="progress-track">
                    <div id="progress" class="progress-bar" style="width:0%"></div>
                </div>
            </div>
        </div>

        <!-- ÏïàÎÇ¥ -->
        <p id="hint-text" class="text-center text-sm mb-4 font-medium" style="color:#6BADE8;">
            Ïà´ÏûêÎ•º ÏàúÏÑúÎåÄÎ°ú ÎπàÏπ∏Ïóê ÎÜìÏïÑÎ¥êÏöî
        </p>

        <!-- Ïä¨Î°Ø ÏòÅÏó≠ (10Ïπ∏ Ìïú Ï§Ñ) -->
        <div id="slots" class="slots-grid mb-5"></div>

        <!-- Íµ¨Î∂ÑÏÑ† -->
        <div class="mb-2" style="border-top:1.5px solid #F0ECE6;"></div>

        <!-- Ïà´Ïûê Ïπ© ÏòÅÏó≠ (Ìù©ÎøåÎ¶¨Í∏∞) -->
        <p class="text-center text-xs mb-2 mt-2" style="color:#D0C8BC;">ÏïÑÎûò Ïà´ÏûêÎ•º ÏúÑ ÎπàÏπ∏ÏúºÎ°ú ÎÅåÏñ¥Îã§ ÎÜìÏúºÏÑ∏Ïöî</p>
        <div id="chips" class="scatter-area"></div>

        <!-- ÌîºÎìúÎ∞± -->
        <div id="feedback" class="text-center h-8 text-base font-bold mt-4" style="color:#4A4035;"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ÎπàÏπ∏ ÎßûÏ∂îÍ∏∞ ÌôîÎ©¥ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="quiz-view" class="hidden flex flex-col flex-1 fade-in">
        <div class="flex items-center gap-3 mb-4">
            <button onclick="goHome()" class="btn-home" title="Ìôà">
                <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-8 9 8M5 11v9a1 1 0 001 1h3m8 0h3a1 1 0 001-1v-9"/></svg>
            </button>
            <div class="flex-1">
                <div class="flex justify-between items-center mb-1">
                    <span id="quiz-label" class="text-xs font-medium" style="color:#B8AD9E;">Î¨∏Ï†ú 1 / 5</span>
                    <span class="text-xs font-medium" style="color:#B8AD9E;">ÎßûÌûå Î¨∏Ï†ú: <span id="quiz-score" style="color:#5BC886;">0</span></span>
                </div>
                <div class="progress-track">
                    <div id="quiz-progress" class="progress-bar" style="width:0%"></div>
                </div>
            </div>
        </div>

        <p id="quiz-hint" class="text-center text-sm mb-5 font-medium" style="color:#6BADE8;">
            Ïà®ÏùÄ Ïà´ÏûêÎ•º Ï∞æÏïÑÏÑú ÎπàÏπ∏Ïóê ÎÜìÏïÑÎ¥êÏöî
        </p>

        <!-- Ïπ¥Îìú Ï§Ñ -->
        <div id="quiz-cards" class="mb-8"></div>

        <!-- Íµ¨Î∂ÑÏÑ† -->
        <div class="mb-4" style="border-top:1.5px solid #F0ECE6;"></div>

        <!-- ÏÑ†ÌÉùÏßÄ Ïπ© -->
        <p class="text-center text-xs mb-3" style="color:#D0C8BC;">Ïà®ÏùÄ Ïà´ÏûêÎ•º ÎÅåÏñ¥Îã§ ÎÜìÏúºÏÑ∏Ïöî</p>
        <div id="quiz-chips" class="flex justify-center gap-3 flex-wrap"></div>

        <div id="quiz-feedback" class="text-center h-8 text-base font-bold mt-6" style="color:#4A4035;"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Í≤∞Í≥º ÌôîÎ©¥ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="result-view" class="hidden flex flex-col flex-1 fade-in">
        <div class="flex-1 flex flex-col justify-center">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üèÜ</div>
                <h2 class="text-2xl font-bold" style="color:#4A4035;">Îã§ ÎßûÌòîÏñ¥Ïöî!</h2>
                <p class="text-sm mt-2" style="color:#B8AD9E;">Ïà´Ïûê ÏàúÏÑúÎ•º Ïûò ÏïåÍ≥† ÏûàÏñ¥Ïöî</p>
            </div>
            <div class="flex flex-col gap-3 mb-8">
                <div class="flex justify-between items-center rounded-2xl p-4" style="background:#F5FAFF; border:1.5px solid #D9EDFC;">
                    <span class="text-sm" style="color:#6B5F50;">Î≤îÏúÑ</span>
                    <span id="r-range" class="text-lg font-bold" style="color:#4A8FC2;">1 Î∂ÄÌÑ∞ 10</span>
                </div>
                <div class="flex justify-between items-center rounded-2xl p-4" style="background:#FFFAF2; border:1.5px solid #F5D5A8;">
                    <span class="text-sm" style="color:#6B5F50;">Í±∏Î¶∞ ÏãúÍ∞Ñ</span>
                    <span id="r-time" class="text-lg font-bold" style="color:#C07830;">0Ï¥à</span>
                </div>
                <div class="flex justify-between items-center rounded-2xl p-4" style="background:#FDE8E8; border:1.5px solid #F5B8B8;">
                    <span class="text-sm" style="color:#6B5F50;">ÌãÄÎ¶∞ ÌöüÏàò</span>
                    <span id="r-wrong" class="text-lg font-bold" style="color:#D04040;">0Î≤à</span>
                </div>
            </div>
        </div>
        <div class="flex gap-3">
            <button onclick="goHome()"
                    class="flex-1 py-3.5 rounded-2xl font-bold text-sm border-2 transition hover:opacity-90 active:scale-[0.98]"
                    style="border-color:#E8E2DA; color:#6B5F50; background:white;">
                ÌôàÏúºÎ°ú
            </button>
            <button onclick="replay()"
                    class="flex-1 py-3.5 rounded-2xl font-bold text-sm border-2 transition hover:opacity-90 active:scale-[0.98]"
                    style="border-color:#C4AA82; color:#7B6545; background:#FAF5EE;">
                Îã§Ïãú ÌïòÍ∏∞
            </button>
        </div>
    </div>
</div>

<script>
    let maxNum = 10;
    let startNum = 1;
    let nextExpected = 1;
    let lastMode = null;  // 'game', 'quiz', 'fill'
    let fillTotal = 0;    // fill Î™®Îìú: ÏÇ¨Ïö©ÏûêÍ∞Ä Ï±ÑÏö∏ Ïπ∏ Ïàò
    let lastRange = 10;
    let lastStart = 1;
    let placedCount = 0;
    let wrongCount = 0;
    let startTime = 0;

    // ÎìúÎûòÍ∑∏ ÏÉÅÌÉú
    let dragging = false;
    let dragValue = null;
    let dragChipEl = null;
    let floatingEl = null;

    // ÏùΩÍ∏∞ Î™®Îìú
    let countingMode = 'sino'; // 'native' = ÌïòÎÇòÎëòÏÖã, 'sino' = ÏùºÏù¥ÏÇº

    function setCountingMode(mode) {
        countingMode = mode;
        document.querySelectorAll('[data-cmode]').forEach(b => {
            b.classList.toggle('selected', b.dataset.cmode === mode);
        });
    }

    // Ï†ïÏàú/Ïó≠Ïàú Î™®Îìú
    let reverseMode = false; // false = Ï†ïÏàú(1‚ÜíN), true = Ïó≠Ïàú(N‚Üí1)

    function setOrderMode(mode) {
        reverseMode = (mode === 'desc');
        document.querySelectorAll('[data-omode]').forEach(b => {
            b.classList.toggle('selected', b.dataset.omode === mode);
        });
    }

    // ÎπàÏπ∏ ÌûåÌä∏ Î™®Îìú
    let ghostMode = false; // false = ÎπàÏπ∏ Ïà®ÍπÄ, true = ÎπàÏπ∏ ÌûåÌä∏(ÌùêÎ¶¨Í≤å ÌëúÏãú)

    function setGhostMode(enabled) {
        ghostMode = enabled;
        document.querySelectorAll('[data-gmode]').forEach(b => {
            b.classList.toggle('selected', (enabled && b.dataset.gmode === 'on') || (!enabled && b.dataset.gmode === 'off'));
        });
    }

    function nativeKorean(n) {
        if (n === 100) return 'Î∞±';
        const ones = ['', 'ÌïòÎÇò', 'Îëò', 'ÏÖã', 'ÎÑ∑', 'Îã§ÏÑØ', 'Ïó¨ÏÑØ', 'ÏùºÍ≥±', 'Ïó¨Îçü', 'ÏïÑÌôâ'];
        const tens = ['', 'Ïó¥', 'Ïä§Î¨º', 'ÏÑúÎ•∏', 'ÎßàÌùî', 'Ïâ∞', 'ÏòàÏàú', 'ÏùºÌùî', 'Ïó¨Îì†', 'ÏïÑÌùî'];
        const t = Math.floor(n / 10);
        const o = n % 10;
        return tens[t] + ones[o];
    }

    function sinoKorean(n) {
        if (n === 100) return 'Î∞±';
        const ones = ['', 'Ïùº', 'Ïù¥', 'ÏÇº', 'ÏÇ¨', 'Ïò§', 'Ïú°', 'Ïπ†', 'Ìåî', 'Íµ¨'];
        if (n <= 0) return '';
        const t = Math.floor(n / 10);
        const o = n % 10;
        let result = '';
        if (t >= 2) result += ones[t];
        if (t >= 1) result += 'Ïã≠';
        result += ones[o];
        return result;
    }

    function countingWord(n) {
        return countingMode === 'native' ? nativeKorean(n) : sinoKorean(n);
    }

    // ÏùåÏÑ±
    let ttsEnabled = true;
    function toggleTTS() {
        ttsEnabled = !ttsEnabled;
        const tog = document.getElementById('tts-toggle');
        const sw = document.getElementById('tts-switch');
        tog.classList.toggle('active', ttsEnabled);
        sw.classList.toggle('on', ttsEnabled);
        if (!ttsEnabled && window.speechSynthesis) window.speechSynthesis.cancel();
    }

    // Ï∂©ÎèôÎ∞©ÏßÄ
    let impulseEnabled = true;
    let impulseDelay = 5;
    let impulseMode = 'lock'; // 'hide' = Î≥¥Í∏∞ ÌôïÏù∏, 'lock' = ÏÑ†ÌÉù Ïû†Í∏à
    let impulseTimer = null;

    function toggleImpulse() {
        impulseEnabled = !impulseEnabled;
        document.getElementById('impulse-switch').classList.toggle('on', impulseEnabled);
        document.getElementById('impulse-toggle').classList.toggle('active', impulseEnabled);
        document.getElementById('impulse-details').classList.toggle('show', impulseEnabled);
    }

    function setImpulseMode(mode) {
        impulseMode = mode;
        document.querySelectorAll('.impulse-mode-btn').forEach(b => {
            b.classList.toggle('selected', b.dataset.mode === mode);
        });
    }

    function setDelay(sec) {
        impulseDelay = sec;
        document.querySelectorAll('.delay-btn').forEach(b => {
            b.classList.toggle('selected', parseInt(b.dataset.delay) === sec);
        });
    }

    function applyImpulseDelay(chipsEl, countdownParent) {
        if (!impulseEnabled) return;

        if (impulseMode === 'hide') {
            chipsEl.classList.add('chips-hidden');
            const revealBtn = document.createElement('button');
            revealBtn.className = 'reveal-btn';
            revealBtn.id = 'revealBtn';
            revealBtn.textContent = 'Î≥¥Í∏∞ ÌôïÏù∏';
            revealBtn.addEventListener('click', () => {
                chipsEl.classList.remove('chips-hidden');
                revealBtn.remove();
            });
            countdownParent.insertBefore(revealBtn, chipsEl);
        } else {
            chipsEl.classList.add('chips-locked');
            const cdEl = document.createElement('div');
            cdEl.className = 'delay-countdown';
            cdEl.id = 'impulse-countdown';
            countdownParent.insertBefore(cdEl, chipsEl);

            let remaining = impulseDelay;
            cdEl.textContent = `${remaining}Ï¥à ÎèôÏïà ÏÉùÍ∞ÅÌï¥ Î≥¥ÏÑ∏Ïöî`;

            impulseTimer = setInterval(() => {
                remaining--;
                if (remaining <= 0) {
                    clearInterval(impulseTimer);
                    impulseTimer = null;
                    cdEl.remove();
                    chipsEl.classList.remove('chips-locked');
                } else {
                    cdEl.textContent = `${remaining}Ï¥à ÎèôÏïà ÏÉùÍ∞ÅÌï¥ Î≥¥ÏÑ∏Ïöî`;
                }
            }, 1000);
        }
    }

    function clearImpulseTimer() {
        if (impulseTimer) { clearInterval(impulseTimer); impulseTimer = null; }
        const cd = document.getElementById('impulse-countdown');
        if (cd) cd.remove();
        const oldReveal = document.getElementById('revealBtn');
        if (oldReveal) oldReveal.remove();
        // ÏûîÏó¨ ÌÅ¥ÎûòÏä§ Ï†ïÎ¶¨
        document.querySelectorAll('.chips-hidden, .chips-locked').forEach(el => {
            el.classList.remove('chips-hidden', 'chips-locked');
        });
    }

    function startGame(range, start) {
        lastMode = 'game';
        lastRange = range;
        startNum = start || 1;
        lastStart = startNum;
        maxNum = range;
        nextExpected = reverseMode ? maxNum : startNum;
        placedCount = 0;
        wrongCount = 0;
        startTime = Date.now();

        document.getElementById('start-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('game-view').classList.remove('hidden');

        const modeLabel = reverseMode ? `${maxNum} ‚Üí ${startNum} Ïó≠Ïàú` : `${startNum} ~ ${maxNum}`;
        document.getElementById('game-label').textContent = modeLabel;
        document.getElementById('feedback').textContent = '';
        updateProgress();

        // Ïä¨Î°Ø ÏÉùÏÑ±
        const slotsEl = document.getElementById('slots');
        slotsEl.innerHTML = '';
        const totalNums = maxNum - startNum + 1;
        const gridCols = totalNums <= 5 ? 5 : 10;
        slotsEl.style.gridTemplateColumns = `repeat(${gridCols}, 1fr)`;
        slotsEl.style.fontSize = maxNum >= 100 ? '0.7rem' : '';
        for (let idx = 0; idx < totalNums; idx++) {
            const num = reverseMode ? (maxNum - idx) : (startNum + idx);
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.num = num;
            if (ghostMode) {
                const ghost = document.createElement('span');
                ghost.className = 'ghost-num';
                ghost.textContent = num;
                slot.appendChild(ghost);
            }
            slotsEl.appendChild(slot);
        }

        // Ïπ© ÏÉùÏÑ± (ÎûúÎç§ ÏúÑÏπòÏóê Ìù©ÎøåÎ¶¨Í∏∞)
        const nums = [];
        for (let i = startNum; i <= maxNum; i++) nums.push(i);
        shuffle(nums);

        const chipsEl = document.getElementById('chips');
        chipsEl.innerHTML = '';
        // Ìù©ÎøåÎ¶¨Í∏∞ ÏòÅÏó≠ ÎÜíÏù¥ Í≥ÑÏÇ∞
        const isTablet = window.innerWidth >= 768;
        const chipPx = isTablet ? 44 : 36;
        const gap = Math.round(chipPx * 0.3);
        const cellSize = chipPx + gap;
        const areaW = chipsEl.offsetWidth || 500;
        const cols = Math.max(1, Math.floor(areaW / cellSize));
        const minRows = Math.ceil(nums.length / cols);
        const totalRows = minRows + Math.max(1, Math.round(minRows * 0.15));
        const scatterH = totalRows * cellSize;
        chipsEl.style.minHeight = scatterH + 'px';

        // Í≤πÏπ® Î∞©ÏßÄÎ•º ÏúÑÌïú ÏúÑÏπò Í≥ÑÏÇ∞
        const positions = scatterPositions(nums.length, areaW, scatterH, chipPx);

        nums.forEach((n, idx) => {
            const chip = document.createElement('div');
            chip.className = 'num-chip';
            chip.textContent = n;
            chip.dataset.num = n;
            chip.style.left = positions[idx].x + 'px';
            chip.style.top = positions[idx].y + 'px';
            bindDrag(chip, n);
            chipsEl.appendChild(chip);
        });

        updateHint();

        // TTS Ï¥àÍ∏∞Ìôî
        if (window.speechSynthesis) speechSynthesis.speak(new SpeechSynthesisUtterance(''));
        setTimeout(() => speak('Ï≤úÏ≤úÌûà ÏÉùÍ∞ÅÌïòÍ≥† ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî.'), 100);

        // Ï∂©ÎèôÎ∞©ÏßÄ
        applyImpulseDelay(chipsEl, chipsEl.parentElement);
    }

    // ‚îÄ‚îÄ Ï†ÑÏ≤¥ ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞ Î™®Îìú ‚îÄ‚îÄ
    const FILL_HINTS = { 5: 2, 10: 3, 20: 6, 30: 9, 50: 15 };

    function startFillGame(range) {
        lastMode = 'fill';
        lastRange = range;
        maxNum = range;
        const hintCount = FILL_HINTS[range] || Math.round(range * 0.3);
        fillTotal = maxNum - hintCount;
        placedCount = 0;
        wrongCount = 0;
        startTime = Date.now();

        document.getElementById('start-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('game-view').classList.remove('hidden');

        document.getElementById('game-label').textContent = `1 ~ ${maxNum} (${hintCount}Í∞ú ÌûåÌä∏)`;
        document.getElementById('feedback').textContent = '';
        updateProgress();

        // Ïä¨Î°Ø ÏÉùÏÑ±
        const slotsEl = document.getElementById('slots');
        slotsEl.innerHTML = '';
        const gridCols = maxNum <= 5 ? 5 : 10;
        slotsEl.style.gridTemplateColumns = `repeat(${gridCols}, 1fr)`;
        slotsEl.style.fontSize = maxNum >= 100 ? '0.7rem' : '';

        // ÎØ∏Î¶¨ Ï±ÑÏö∏ Ïà´ÏûêÎ•º ÎûúÎç§ ÏÑ†ÌÉù
        const allNums = [];
        for (let i = 1; i <= maxNum; i++) allNums.push(i);
        const shuffled = [...allNums];
        shuffle(shuffled);
        const prefilledSet = new Set(shuffled.slice(0, hintCount));

        for (let idx = 0; idx < maxNum; idx++) {
            const num = idx + 1;
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.num = num;
            if (prefilledSet.has(num)) {
                slot.textContent = num;
                slot.classList.add('filled');
                slot.style.fontSize = '1.25rem';
                slot.style.background = '#E8F5E9';
                slot.style.color = '#388E3C';
            } else if (ghostMode) {
                const ghost = document.createElement('span');
                ghost.className = 'ghost-num';
                ghost.textContent = num;
                slot.appendChild(ghost);
            }
            slotsEl.appendChild(slot);
        }

        // ÎÇòÎ®∏ÏßÄ Ïà´ÏûêÎßå Ïπ©ÏúºÎ°ú ÏÉùÏÑ±
        const chipNums = allNums.filter(n => !prefilledSet.has(n));
        shuffle(chipNums);

        const chipsEl = document.getElementById('chips');
        chipsEl.innerHTML = '';
        const isTablet = window.innerWidth >= 768;
        const chipPx = isTablet ? 44 : 36;
        const gap = Math.round(chipPx * 0.3);
        const cellSize = chipPx + gap;
        const areaW = chipsEl.offsetWidth || 500;
        const cols = Math.max(1, Math.floor(areaW / cellSize));
        const minRows = Math.ceil(chipNums.length / cols);
        const totalRows = minRows + Math.max(1, Math.round(minRows * 0.15));
        const scatterH = totalRows * cellSize;
        chipsEl.style.minHeight = scatterH + 'px';

        const positions = scatterPositions(chipNums.length, areaW, scatterH, chipPx);

        chipNums.forEach((n, idx) => {
            const chip = document.createElement('div');
            chip.className = 'num-chip';
            chip.textContent = n;
            chip.dataset.num = n;
            chip.style.left = positions[idx].x + 'px';
            chip.style.top = positions[idx].y + 'px';
            bindDrag(chip, n);
            chipsEl.appendChild(chip);
        });

        updateHint();

        if (window.speechSynthesis) speechSynthesis.speak(new SpeechSynthesisUtterance(''));
        setTimeout(() => speak('ÌûåÌä∏Î•º Î≥¥Í≥† ÎÇòÎ®∏ÏßÄÎ•º Ï±ÑÏõåÎ¥êÏöî.'), 100);

        applyImpulseDelay(chipsEl, chipsEl.parentElement);
    }

    function bindDrag(chip, value) {
        chip.addEventListener('mousedown', e => {
            e.preventDefault();
            beginDrag(chip, value, e.clientX, e.clientY);
        });
        chip.addEventListener('touchstart', e => {
            e.preventDefault();
            const t = e.touches[0];
            beginDrag(chip, value, t.clientX, t.clientY);
        }, { passive: false });
    }

    function beginDrag(chip, value, x, y) {
        if (dragging) return;
        dragging = true;
        dragValue = value;
        dragChipEl = chip;
        chip.classList.add('dragging');

        floatingEl = document.createElement('div');
        floatingEl.className = 'floating-num';
        floatingEl.textContent = value;
        floatingEl.style.left = x + 'px';
        floatingEl.style.top = y + 'px';
        document.body.appendChild(floatingEl);

        highlightTarget(x, y);
    }

    function isQuizMode() {
        return !document.getElementById('quiz-view').classList.contains('hidden');
    }

    function moveHandler(x, y) {
        if (!dragging || !floatingEl) return;
        floatingEl.style.left = x + 'px';
        floatingEl.style.top = y + 'px';
        if (isQuizMode()) highlightQuizTarget(x, y);
        else highlightTarget(x, y);
    }

    function endHandler(x, y) {
        if (!dragging) return;

        if (isQuizMode()) {
            endQuizDrag(x, y);
            return;
        }

        // Ïñ¥Îñ§ Ïä¨Î°Ø ÏúÑÏù∏ÏßÄ ÌôïÏù∏
        const target = getSlotAt(x, y);
        clearHighlights();

        if (target && !target.classList.contains('filled')) {
            const slotNum = parseInt(target.dataset.num);

            if (lastMode === 'fill') {
                // fill Î™®Îìú: ÏàúÏÑú Î¨¥Í¥Ä, Ïà´ÏûêÍ∞Ä Ïä¨Î°ØÍ≥º ÏùºÏπòÌïòÎ©¥ Ï†ïÎãµ
                if (dragValue === slotNum) {
                    placeNumber(target, dragValue);
                } else {
                    wrongCount++;
                    target.classList.add('wrong');
                    setTimeout(() => target.classList.remove('wrong'), 400);
                    const fb = document.getElementById('feedback');
                    fb.textContent = 'Ïù¥ Ïπ∏ÏùÄ Îã§Î•∏ Ïà´Ïûê ÏûêÎ¶¨ÏòàÏöî';
                    fb.style.color = '#F07070';
                    speak('Îã§Ïãú Ìï¥Î¥êÏöî.');
                }
            } else {
                // game Î™®Îìú: ÏàúÏÑúÎåÄÎ°úÎßå ÎÜìÏùÑ Ïàò ÏûàÏùå
                if (dragValue === slotNum && dragValue === nextExpected) {
                    placeNumber(target, dragValue);
                } else {
                    wrongCount++;
                    target.classList.add('wrong');
                    setTimeout(() => target.classList.remove('wrong'), 400);
                    const fb = document.getElementById('feedback');
                    if (dragValue !== nextExpected) {
                        fb.textContent = `${nextExpected}ÏùÑ Î®ºÏ†Ä ÎÜìÏïÑÏïº Ìï¥Ïöî`;
                    } else {
                        fb.textContent = 'Ïù¥ Ïπ∏ÏùÄ Îã§Î•∏ Ïà´Ïûê ÏûêÎ¶¨ÏòàÏöî';
                    }
                    fb.style.color = '#F07070';
                    speak('Îã§Ïãú Ìï¥Î¥êÏöî.');
                }
            }
        }

        // Ï†ïÎ¶¨
        if (floatingEl) { floatingEl.remove(); floatingEl = null; }
        if (dragChipEl) dragChipEl.classList.remove('dragging');
        dragging = false;
        dragValue = null;
        dragChipEl = null;
    }

    function placeNumber(slot, value) {
        slot.innerHTML = '';
        slot.textContent = value;
        slot.classList.add('filled', 'pop-in');
        slot.style.fontSize = '1.25rem';

        // Ïπ© Ïà®Í∏∞Í∏∞
        dragChipEl.classList.add('placed');

        placedCount++;
        if (lastMode !== 'fill') {
            if (reverseMode) {
                nextExpected--;
            } else {
                nextExpected++;
            }
        }
        updateProgress();
        updateHint();

        const fb = document.getElementById('feedback');
        const totalTarget = lastMode === 'fill' ? fillTotal : (maxNum - startNum + 1);

        if (placedCount >= totalTarget) {
            fb.textContent = 'ÏôÑÏÑ±! üéâ';
            fb.style.color = '#5BC886';
            speak('Îã§ ÎßûÌòîÏñ¥Ïöî! Ï†ïÎßê ÏûòÌñàÏñ¥Ïöî.');
            setTimeout(showResult, 1500);
        } else {
            fb.textContent = 'ÏûòÌñàÏñ¥Ïöî!';
            fb.style.color = '#5BC886';
            speak(countingWord(value));
            setTimeout(() => {
                if (fb.textContent === 'ÏûòÌñàÏñ¥Ïöî!') {
                    fb.textContent = '';
                }
            }, 800);
        }
    }

    function highlightTarget(x, y) {
        clearHighlights();
        const target = getSlotAt(x, y);
        if (target && !target.classList.contains('filled')) {
            target.classList.add('drag-over');
        }
    }

    function clearHighlights() {
        document.querySelectorAll('.slot.drag-over').forEach(s => s.classList.remove('drag-over'));
    }

    function getSlotAt(x, y) {
        const slots = document.querySelectorAll('.slot');
        for (const slot of slots) {
            const r = slot.getBoundingClientRect();
            if (x >= r.left && x <= r.right && y >= r.top && y <= r.bottom) {
                return slot;
            }
        }
        return null;
    }

    function updateProgress() {
        const total = lastMode === 'fill' ? fillTotal : (maxNum - startNum + 1);
        document.getElementById('placed-label').textContent = `${placedCount} / ${total}`;
        document.getElementById('progress').style.width = `${(placedCount / total) * 100}%`;
    }

    function updateHint() {
        const hint = document.getElementById('hint-text');
        const total = lastMode === 'fill' ? fillTotal : (maxNum - startNum + 1);
        if (placedCount >= total) {
            hint.textContent = 'ÏôÑÏÑ±!';
            hint.style.color = '#5BC886';
        } else if (lastMode === 'fill') {
            const remaining = fillTotal - placedCount;
            hint.textContent = `${remaining}Í∞ú ÎÇ®ÏïòÏñ¥Ïöî`;
            hint.style.color = '#C4AA82';
        } else {
            const direction = reverseMode ? '(Ïó≠Ïàú) ' : '';
            hint.textContent = `${direction}Îã§Ïùå Ïà´Ïûê: ${nextExpected}`;
            hint.style.color = '#6BADE8';
        }
    }

    function showResult() {
        const sec = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById('game-view').classList.add('hidden');
        document.getElementById('result-view').classList.remove('hidden');
        const rangeText = reverseMode ? `${maxNum} ‚Üí ${startNum} Ïó≠Ïàú` : `${startNum} ~ ${maxNum}`;
        document.getElementById('r-range').textContent = rangeText;
        document.getElementById('r-time').textContent = `${sec}Ï¥à`;
        document.getElementById('r-wrong').textContent = `${wrongCount}Î≤à`;
    }

    function replay() {
        document.getElementById('result-view').classList.add('hidden');
        if (lastMode === 'game') startGame(lastRange, lastStart);
        else if (lastMode === 'quiz') startQuiz(lastRange);
        else if (lastMode === 'fill') startFillGame(lastRange);
        else goHome();
    }

    function goHome() {
        clearImpulseTimer();
        if (floatingEl) { floatingEl.remove(); floatingEl = null; }
        dragging = false;
        document.getElementById('game-view').classList.add('hidden');
        document.getElementById('quiz-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('start-view').classList.remove('hidden');
    }

    // ‚îÄ‚îÄ ÎπàÏπ∏ ÎßûÏ∂îÍ∏∞ Î™®Îìú ‚îÄ‚îÄ
    const QUIZ_TOTAL = 5;
    let quizRound = 0;
    let quizCorrect = 0;
    let quizWrong = 0;
    let quizStartTime = 0;
    let quizNumbers = [];      // Ï†ïÎ†¨Îêú 6Í∞ú Ïà´Ïûê
    let quizHiddenSet = null;  // Ïà®Í∏¥ 3Í∞ú Set
    let quizNextHidden = null; // ÏôºÏ™ΩÎ∂ÄÌÑ∞ ÎßûÏ∂ú Îã§Ïùå Ïà®Í∏¥ Ïà´Ïûê
    let quizHiddenOrder = [];  // Ïà®Í∏¥ Ïà´Ïûê Ïôº‚ÜíÏò§ ÏàúÏÑú
    let quizPlacedInRound = 0;
    let quizFirstTryInRound = true;
    let quizRange = 10;

    function startQuiz(range) {
        lastMode = 'quiz';
        lastRange = range;
        quizRange = range;
        quizRound = 0;
        quizCorrect = 0;
        quizWrong = 0;
        quizStartTime = Date.now();

        document.getElementById('start-view').classList.add('hidden');
        document.getElementById('result-view').classList.add('hidden');
        document.getElementById('quiz-view').classList.remove('hidden');

        if (window.speechSynthesis) speechSynthesis.speak(new SpeechSynthesisUtterance(''));
        nextQuizRound();
    }

    function nextQuizRound() {
        quizRound++;
        quizPlacedInRound = 0;
        quizFirstTryInRound = true;

        document.getElementById('quiz-label').textContent = `Î¨∏Ï†ú ${quizRound} / ${QUIZ_TOTAL}`;
        document.getElementById('quiz-progress').style.width = `${(quizRound - 1) / QUIZ_TOTAL * 100}%`;
        document.getElementById('quiz-score').textContent = quizCorrect;
        document.getElementById('quiz-feedback').textContent = '';
        document.getElementById('quiz-hint').textContent = 'Ïà®ÏùÄ Ïà´ÏûêÎ•º Ï∞æÏïÑÏÑú ÎπàÏπ∏Ïóê ÎÜìÏïÑÎ¥êÏöî';
        document.getElementById('quiz-hint').style.color = '#6BADE8';

        const cardCount = quizRange <= 5 ? 5 : 8;
        const hideCount = quizRange <= 5 ? 2 : 4;

        const maxStart = quizRange - cardCount + 1;
        const start = Math.floor(Math.random() * maxStart) + 1;
        quizNumbers = [];
        for (let i = start; i < start + cardCount; i++) quizNumbers.push(i);

        // Ïà®Í∏∞Í∏∞
        const indices = [];
        for (let i = 0; i < cardCount; i++) indices.push(i);
        shuffle(indices);
        const hiddenIndices = new Set(indices.slice(0, hideCount));
        quizHiddenSet = new Set();
        quizHiddenOrder = [];
        quizNumbers.forEach((n, i) => {
            if (hiddenIndices.has(i)) {
                quizHiddenSet.add(n);
                quizHiddenOrder.push(n);
            }
        });
        quizNextHidden = quizHiddenOrder[0];

        // Ïπ¥Îìú Î†åÎçîÎßÅ
        const cardsEl = document.getElementById('quiz-cards');
        cardsEl.innerHTML = '';
        cardsEl.classList.toggle('quiz-cards-8', cardCount >= 8);
        quizNumbers.forEach((n, i) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            if (hiddenIndices.has(i)) {
                card.classList.add('hidden-card');
                card.textContent = '?';
                card.dataset.num = n;
            } else {
                card.classList.add('open');
                card.textContent = n;
            }
            cardsEl.appendChild(card);
        });

        // Ïπ© Î†åÎçîÎßÅ (Ïà®Í∏¥ 3Í∞úÎ•º ÎûúÎç§ ÏàúÏÑúÎ°ú)
        const hiddenNums = [...quizHiddenSet];
        shuffle(hiddenNums);
        const chipsEl = document.getElementById('quiz-chips');
        chipsEl.innerHTML = '';
        hiddenNums.forEach(n => {
            const chip = document.createElement('div');
            chip.className = 'quiz-chip';
            chip.textContent = n;
            chip.dataset.num = n;
            bindQuizDrag(chip, n);
            chipsEl.appendChild(chip);
        });

        // Ï∂©ÎèôÎ∞©ÏßÄ
        clearImpulseTimer();
        applyImpulseDelay(chipsEl, chipsEl.parentElement);
    }

    function bindQuizDrag(chip, value) {
        chip.addEventListener('mousedown', e => {
            e.preventDefault();
            beginQuizDrag(chip, value, e.clientX, e.clientY);
        });
        chip.addEventListener('touchstart', e => {
            e.preventDefault();
            const t = e.touches[0];
            beginQuizDrag(chip, value, t.clientX, t.clientY);
        }, { passive: false });
    }

    function beginQuizDrag(chip, value, x, y) {
        if (dragging) return;
        dragging = true;
        dragValue = value;
        dragChipEl = chip;
        chip.classList.add('dragging');

        floatingEl = document.createElement('div');
        floatingEl.className = 'floating-num';
        floatingEl.textContent = value;
        floatingEl.style.left = x + 'px';
        floatingEl.style.top = y + 'px';
        document.body.appendChild(floatingEl);

        highlightQuizTarget(x, y);
    }

    function highlightQuizTarget(x, y) {
        document.querySelectorAll('.quiz-card.hidden-card.drag-over').forEach(c => c.classList.remove('drag-over'));
        const target = getQuizCardAt(x, y);
        if (target && !target.classList.contains('filled')) {
            target.classList.add('drag-over');
        }
    }

    function getQuizCardAt(x, y) {
        const cards = document.querySelectorAll('.quiz-card.hidden-card');
        for (const card of cards) {
            const r = card.getBoundingClientRect();
            if (x >= r.left && x <= r.right && y >= r.top && y <= r.bottom) {
                return card;
            }
        }
        return null;
    }

    function endQuizDrag(x, y) {
        document.querySelectorAll('.quiz-card.hidden-card.drag-over').forEach(c => c.classList.remove('drag-over'));

        const target = getQuizCardAt(x, y);
        if (target && !target.classList.contains('filled')) {
            const cardNum = parseInt(target.dataset.num);
            if (dragValue === cardNum) {
                // Ï†ïÎãµ
                target.textContent = cardNum;
                target.classList.add('filled', 'pop-in');
                dragChipEl.classList.add('placed');
                quizPlacedInRound++;

                const fb = document.getElementById('quiz-feedback');

                if (quizPlacedInRound >= quizHiddenOrder.length) {
                    // Ïù¥ ÎùºÏö¥Îìú ÏôÑÏÑ±
                    if (quizFirstTryInRound) quizCorrect++;
                    document.getElementById('quiz-score').textContent = quizCorrect;
                    document.getElementById('quiz-progress').style.width = `${quizRound / QUIZ_TOTAL * 100}%`;
                    fb.textContent = 'Ï†ïÎãµÏù¥ÏóêÏöî! üéâ';
                    fb.style.color = '#5BC886';
                    speak('Ï†ïÎãµÏù¥ÏóêÏöî.');

                    if (quizRound >= QUIZ_TOTAL) {
                        setTimeout(showQuizResult, 1500);
                    } else {
                        setTimeout(nextQuizRound, 1300);
                    }
                } else {
                    fb.textContent = 'ÏûòÌñàÏñ¥Ïöî!';
                    fb.style.color = '#5BC886';
                    speak(String(cardNum));
                    setTimeout(() => { if (fb.textContent === 'ÏûòÌñàÏñ¥Ïöî!') fb.textContent = ''; }, 800);
                }
            } else {
                // Ïò§Îãµ
                quizWrong++;
                quizFirstTryInRound = false;
                target.classList.add('wrong');
                setTimeout(() => target.classList.remove('wrong'), 400);
                const fb = document.getElementById('quiz-feedback');
                fb.textContent = 'Ïù¥ Ïπ∏ÏùÄ Îã§Î•∏ Ïà´Ïûê ÏûêÎ¶¨ÏòàÏöî';
                fb.style.color = '#F07070';
                speak('Îã§Ïãú Ìï¥Î¥êÏöî.');
            }
        }

        // Ï†ïÎ¶¨
        if (floatingEl) { floatingEl.remove(); floatingEl = null; }
        if (dragChipEl) dragChipEl.classList.remove('dragging');
        dragging = false;
        dragValue = null;
        dragChipEl = null;
    }

    function showQuizResult() {
        const sec = Math.floor((Date.now() - quizStartTime) / 1000);
        document.getElementById('quiz-view').classList.add('hidden');
        document.getElementById('result-view').classList.remove('hidden');
        document.getElementById('r-range').textContent = `ÎπàÏπ∏ 1~${quizRange}`;
        document.getElementById('r-time').textContent = `${sec}Ï¥à`;
        document.getElementById('r-wrong').textContent = `${quizWrong}Î≤à`;
        speak(`Îã§ ÌíÄÏóàÏñ¥Ïöî. ${nativeNum(quizCorrect)} Î¨∏Ï†ú ÎßûÌòîÏñ¥Ïöî.`);
    }

    function scatterPositions(count, areaW, areaH, chipSize) {
        const gap = Math.round(chipSize * 0.3);
        const cell = chipSize + gap;
        const jitter = Math.round(gap * 0.4);
        const cols = Math.max(1, Math.floor(areaW / cell));
        const minRows = Math.ceil(count / cols);
        const totalRows = minRows + Math.max(1, Math.round(minRows * 0.15));
        const totalCells = totalRows * cols;

        // ÏÖÄ Ïù∏Îç±Ïä§Î•º ÏÑûÏñ¥ÏÑú countÍ∞úÎßå ÏÑ†ÌÉù ‚Üí Îπà ÏÖÄÏù¥ ÏÉùÍ≤® Ìù©ÎøåÎ¶∞ ÎäêÎÇå
        const indices = [];
        for (let i = 0; i < totalCells; i++) indices.push(i);
        shuffle(indices);
        const chosen = indices.slice(0, count);

        const offsetX = Math.max(0, (areaW - cols * cell) / 2);

        return chosen.map(idx => {
            const col = idx % cols;
            const row = Math.floor(idx / cols);
            return {
                x: offsetX + col * cell + Math.random() * jitter,
                y: row * cell + Math.random() * jitter
            };
        });
    }

    function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
    }

    // Í≥†Ïú†Ïñ¥ ÏàòÏÇ¨ (Î¨∏Ï†ú, Í∞ú Îì± Îã®ÏúÑ ÏïûÏóê ÏÇ¨Ïö©)
    function nativeNum(n) {
        const w = ['', 'Ìïú', 'Îëê', 'ÏÑ∏', 'ÎÑ§', 'Îã§ÏÑØ', 'Ïó¨ÏÑØ', 'ÏùºÍ≥±', 'Ïó¨Îçü', 'ÏïÑÌôâ', 'Ïó¥'];
        return w[n] || String(n);
    }

    function speak(text) {
        if (!ttsEnabled || !window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ko-KR'; u.rate = 0.9;
        setTimeout(() => window.speechSynthesis.speak(u), 50);
    }

    // Ï†ÑÏó≠ Ïù¥Î≤§Ìä∏
    document.addEventListener('mousemove', e => moveHandler(e.clientX, e.clientY));
    document.addEventListener('mouseup', e => endHandler(e.clientX, e.clientY));
    document.addEventListener('touchmove', e => {
        if (dragging) { e.preventDefault(); const t = e.touches[0]; moveHandler(t.clientX, t.clientY); }
    }, { passive: false });
    document.addEventListener('touchend', e => {
        if (dragging) { const t = e.changedTouches[0]; endHandler(t.clientX, t.clientY); }
    });

    // TTS Ï¥àÍ∏∞Ìôî
    if (window.speechSynthesis) {
        speechSynthesis.getVoices();
        if (speechSynthesis.onvoiceschanged !== undefined)
            speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    }

    // ---- Social Login ----
    function socialLogin(provider) {
        localStorage.setItem('slowmath_number_login', JSON.stringify({
            provider: provider,
            loginTime: new Date().toISOString()
        }));
        document.getElementById('login-view').classList.add('hidden');
        document.getElementById('start-view').classList.remove('hidden');
    }

    function socialLogout() {
        localStorage.removeItem('slowmath_number_login');
        document.getElementById('start-view').classList.add('hidden');
        document.getElementById('login-view').classList.remove('hidden');
    }

    // Check login state on load
    (function checkLoginState() {
        var loginData = localStorage.getItem('slowmath_number_login');
        if (loginData) {
            document.getElementById('login-view').classList.add('hidden');
            document.getElementById('start-view').classList.remove('hidden');
        }
    })();
</script>

</body>
</html>
